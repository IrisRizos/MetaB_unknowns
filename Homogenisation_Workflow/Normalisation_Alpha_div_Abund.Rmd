---
title: 'Unassigned MetaB: normalisation, a-diversity, abundance'
author: "Iris Rizos"
date: "13/04/2022"
output: 
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# setwd("/shared/projects/formaldark/R_igraph/Final_files/")

# Import packages
library(data.table)
library(maps)
library(tidyverse)
library(vegan)
library(ggplot2)
library(ggsci)
library(gridExtra)
```

## 1. Normalisation

Input: abundance tables resulting from homogenisation workflow 
(no multicellular taxa, PR2 v4.12.0 taxonomy, sequences >200 bp, id of seq with ref when creating OTUs 95% for BBMO and Malaspina, 80% for ASTAN, SOLA, Biomarks, MOOSE)

Output: normalised abundance table by TSS

Total Sum Scalling (TSS) by sample, i.e. 0-1 scaling by sample

```{r}
##--- BioMarKs ---##
###
#------Varna
# Read ASV table
t=read.csv("/shared/projects/formaldark/datasets/Biomarks/omics/ASV_Biom_Varna_filt_PR2_f200.csv",h=T, sep=";",row.names = 1)
# Keep abundance columns
Abund <- data.frame(t[,11:31])

# Calculate sum of ASV abundance in each sample
col <- colSums(Abund)

# Normalisation function: divide each row element by column sum #
norm_abund <- function(x) {
  a <- x/col
  return(a)
}

# Apply normalisation function and convert matrix into data frame
Abund_N = apply(Abund,1,norm_abund)
Abund_N <- as.data.frame(t(Abund_N))

# Sum of columns should now be equal to 1
colSums(Abund_N)

# Save normalised abundance table
write.csv(Abund_N,'Biom_Varna_abund_N2_PR2_filt.csv')

###
#------Barcelona
t=read.csv("/shared/projects/formaldark/datasets/Biomarks/omics/ASV_Biom_Barc_filt_PR2_f200.csv",h=T, sep=";",row.names = 1)
Abund <- data.frame(t[,11:19])
col <- colSums(Abund)

Abund_N = apply(Abund,1,norm_abund)
Abund_N <- as.data.frame(t(Abund_N))
colSums(Abund_N)

write.csv(Abund_N,'Biom_Barc_abund_N2_PR2_filt.csv')

###
#------Gijon
t=read.csv("/shared/projects/formaldark/datasets/Biomarks/omics/ASV_Biom_Gijon_filt_PR2_f200.csv",h=T, sep=";",row.names = 1)
Abund <- data.frame(t[,11:14])
col <- colSums(Abund)

Abund_N = apply(Abund,1,norm_abund)
Abund_N <- as.data.frame(t(Abund_N))
colSums(Abund_N)

write.csv(Abund_N,'Biom_Gijon_abund_N2_PR2_filt.csv')

###
#------Naples
t=read.csv("/shared/projects/formaldark/datasets/Biomarks/omics/ASV_Biom_Naples_filt_PR2_f200.csv",h=T, sep=";",row.names = 1)
Abund <- data.frame(t[,11:50])
col <- colSums(Abund)

Abund_N = apply(Abund,1,norm_abund)
Abund_N <- as.data.frame(t(Abund_N))
colSums(Abund_N)

write.csv(Abund_N,'Biom_Naples_abund_N2_PR2_filt.csv')

###
#------Roscoff
t=read.csv("/shared/projects/formaldark/datasets/Biomarks/omics/ASV_Biom_Rosc_filt_PR2_f200.csv",h=T, sep=";",row.names = 1)
Abund <- data.frame(t[,11:17])
col <- colSums(Abund)

Abund_N = apply(Abund,1,norm_abund)
Abund_N <- as.data.frame(t(Abund_N))
colSums(Abund_N)

write.csv(Abund_N,'Biom_Rosc_abund_N2_PR2_filt.csv')

###
#------Oslo
t=read.csv("/shared/projects/formaldark/datasets/Biomarks/omics/ASV_Biom_Oslo_filt_PR2_f200.csv",h=T, sep=";",row.names = 1)
Abund <- data.frame(t[,11:44])
col <- colSums(Abund)

Abund_N = apply(Abund,1,norm_abund)
Abund_N <- as.data.frame(t(Abund_N))
colSums(Abund_N)

write.csv(Abund_N,'Biom_Oslo_abund_N2_PR2_filt.csv')

##--- ASTAN ---##
t=read.csv("/shared/projects/formaldark/datasets/Astan/ASV_ASTAN_filt_PR2_f200.csv",h=T, sep=";",row.names = 1)
Abund <- data.frame(t[,11:384])
col <- colSums(Abund)

Abund_N = apply(Abund,1,norm_abund)
Abund_N <- as.data.frame(t(Abund_N))
colSums(Abund_N)

write.csv(Abund_N,'ASTAN_abund_N2_PR2_filt.csv')

##--- SOLA ---##
t=read.csv("/shared/projects/formaldark/datasets/Sola/ASV_SOLA_filt_PR2_f200.csv",h=T, sep=";",row.names = 1)
Abund <- data.frame(t[,10:167])
col <- colSums(Abund)

Abund_N = apply(Abund,1,norm_abund)
Abund_N <- as.data.frame(t(Abund_N))
colSums(Abund_N)

write.csv(Abund_N,'SOLA_abund_N2_PR2_filt.csv')

##--- BBMO ---##
t=read.csv("/shared/projects/formaldark/datasets/BBMO/ASV_BBMO_filt_PR2_f200.csv",h=T, sep=";",row.names = 1)
Abund <- data.frame(t[,9:335])
col <- colSums(Abund)

Abund_N = apply(Abund,1,norm_abund)
Abund_N <- as.data.frame(t(Abund_N))
colSums(Abund_N)

write.csv(Abund_N,'BBMO_abund_N2_PR2_filt.csv')

##--- MOOSE ---##
t=read.csv("/shared/projects/formaldark/datasets/Moose/ASV_MOOSE_filt_PR2_f200.csv",h=T, sep=";",row.names = 1)
Abund <- data.frame(t[,10:282])
col <- colSums(Abund)

Abund_N = apply(Abund,1,norm_abund)
Abund_N <- as.data.frame(t(Abund_N))
colSums(Abund_N)

write.csv(Abund_N,'MOOSE_abund_N2_PR2_filt.csv')

##--- Malaspina ---##
t=read.csv("/shared/projects/formaldark/datasets/Malaspina/ASV_Malaspina_filt_PR2_f200.csv",h=T, sep=";",row.names = 1)
Abund <- data.frame(t[,9:297])
col <- colSums(Abund)

Abund_N = apply(Abund,1,norm_abund)
Abund_N <- as.data.frame(t(Abund_N))
colSums(Abund_N)

write.csv(Abund_N,'Mal_abund_N2_PR2_filt.csv')
```

## 2. Homogenisation workflow: unassigned metabarcodes at each taxonomic level

Figure S3 (A)

Initial taxonomy
```{r}
# Initial datasets
donUK=read.csv("/shared/projects/formaldark/Data_stageM2/UK_Perc_prePR2.csv",h=T,sep=";")

donUK[donUK$Dataset=="Astan",1]<-"ASTAN"
donUK[donUK$Dataset=="Sola",1]<-"SOLA"
donUK[donUK$Dataset=="Moose",1]<-"MOOSE"
donUK[donUK$Dataset=="Blanes",1]<-"BBMO"
donUK[donUK$Dataset=="Biomarks",1]<-"BioMarKs"

donUK$Taxo_level <- factor(donUK$Taxo_level,levels = c("Kingdom", "Supergroup", "Division", "Class", "Order","Family","Genus","Species"))
donUK$Dataset <- factor(donUK$Dataset ,levels = c("BioMarKs", "ASTAN", "BBMO", "SOLA","Malaspina","MOOSE"))

p0 <- ggplot(donUK, aes(fill=Dataset, y=Unknowns, x=Taxo_level)) + 
  geom_bar(position="dodge", stat="identity", colour="black") +
  geom_hline(aes(yintercept=50.00), color="red", linetype="dashed", size=0.5) +
  theme_linedraw() +
  facet_grid(~Taxo_level, scales = "free_x") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_uchicago(palette ="default", alpha = 1) +
  ylab("Number of unassigned metabarcodes (%)") +
  ggtitle("Initial taxonomy") +
  theme(plot.title = element_text(hjust=0.5, face="bold"))

plot(p0)
```

After taxonomic assignment PR2 v4.12.0
```{r}
donUK_PR2=read.csv("/shared/projects/formaldark/Data_stageM2/UK_Perc_PR2.csv",h=T,sep=";")

donUK_PR2[donUK_PR2$Dataset=="Astan",1]<-"ASTAN"
donUK_PR2[donUK_PR2$Dataset=="Sola",1]<-"SOLA"
donUK_PR2[donUK_PR2$Dataset=="Moose",1]<-"MOOSE"
donUK_PR2[donUK_PR2$Dataset=="Blanes",1]<-"BBMO"
donUK_PR2[donUK_PR2$Dataset=="Biomarks",1]<-"BioMarKs"

donUK_PR2$Taxo_level <- factor(donUK_PR2$Taxo_level,levels = c("Kingdom", "Supergroup", "Division", "Class", "Order","Family","Genus","Species"))
donUK_PR2$Dataset <- factor(donUK_PR2$Dataset ,levels = c("BioMarKs", "ASTAN", "BBMO", "SOLA","Malaspina","MOOSE"))

p01 <- ggplot(donUK_PR2, aes(fill=Dataset, y=Unknowns, x=Taxo_level)) + 
  geom_bar(position="dodge", stat="identity", colour="black") +
  geom_hline(aes(yintercept=50.00), color="red", linetype="dashed", size=0.5) +
  theme_linedraw() +
  facet_grid(~Taxo_level, scales = "free_x") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_uchicago(palette ="default", alpha = 1) +
  ylab("Number of unassigned metabarcodes (%)") +
  ggtitle("PR2 v4.12.0") +
  theme(plot.title = element_text(hjust=0.5, face="bold"))

plot(p01)
```

## 3. Diversity and abundance of unassigned metabarcodes at each taxonomic level 

After homogenisation workflow.
Contamination check was performed with Silva only for metabarcodes that were unassigned at the Kingdom level.

Figure S3 (B)

# Relative number of unassigned metabarcodes

```{r}
# Diversity #
# Count number of unassigned barcodes at each taxonomic level
tax_all=read.csv("/shared/projects/formaldark/Data_stageM2/All_seq_taxTable_noAB_PR2_EKsilva.csv",h=T,sep=";")

# Biomarks
biom <- subset(tax_all, tax_all$ASV %like% "ASV_Biom_")

UK_biom_K <- 100*(nrow(biom[biom$Kingdom=="Unknown",]))/nrow(biom)
UK_biom_S <- 100*(nrow(biom[biom$Supergroup=="Unknown",]))/nrow(biom)
UK_biom_D <- 100*(nrow(biom[biom$Division=="Unknown",]))/nrow(biom)
UK_biom_C <- 100*(nrow(biom[biom$Class=="Unknown",]))/nrow(biom)
UK_biom_O <- 100*(nrow(biom[biom$Order=="Unknown",]))/nrow(biom)
UK_biom_F <- 100*(nrow(biom[biom$Family=="Unknown",]))/nrow(biom)
UK_biom_G <- 100*(nrow(biom[biom$Genus=="Unknown",]))/nrow(biom)
UK_biom_Sp <- 100*(nrow(biom[biom$Species=="Unknown",]))/nrow(biom)

# ASTAN
astan <- subset(tax_all, tax_all$ASV %like% "ASV_Ast_")

UK_astan_K <- 100*(nrow(astan[astan$Kingdom=="Unknown",]))/nrow(astan)
UK_astan_S <- 100*(nrow(astan[astan$Supergroup=="Unknown",]))/nrow(astan)
UK_astan_D <- 100*(nrow(astan[astan$Division=="Unknown",]))/nrow(astan)
UK_astan_C <- 100*(nrow(astan[astan$Class=="Unknown",]))/nrow(astan)
UK_astan_O <- 100*(nrow(astan[astan$Order=="Unknown",]))/nrow(astan)
UK_astan_F <- 100*(nrow(astan[astan$Family=="Unknown",]))/nrow(astan)
UK_astan_G <- 100*(nrow(astan[astan$Genus=="Unknown",]))/nrow(astan)
UK_astan_Sp <- 100*(nrow(astan[astan$Species=="Unknown",]))/nrow(astan)

# BBMO
bbmo <- subset(tax_all, tax_all$ASV %like% "ASV_BBMO_")

UK_bbmo_K <- 100*(nrow(bbmo[bbmo$Kingdom=="Unknown",]))/nrow(bbmo)
UK_bbmo_S <- 100*(nrow(bbmo[bbmo$Supergroup=="Unknown",]))/nrow(bbmo)
UK_bbmo_D <- 100*(nrow(bbmo[bbmo$Division=="Unknown",]))/nrow(bbmo)
UK_bbmo_C <- 100*(nrow(bbmo[bbmo$Class=="Unknown",]))/nrow(bbmo)
UK_bbmo_O <- 100*(nrow(bbmo[bbmo$Order=="Unknown",]))/nrow(bbmo)
UK_bbmo_F <- 100*(nrow(bbmo[bbmo$Family=="Unknown",]))/nrow(bbmo)
UK_bbmo_G <- 100*(nrow(bbmo[bbmo$Genus=="Unknown",]))/nrow(bbmo)
UK_bbmo_Sp <- 100*(nrow(bbmo[bbmo$Species=="Unknown",]))/nrow(bbmo)

# SOLA
sola <- subset(tax_all, tax_all$ASV %like% "ASV_Sol_")

UK_sola_K <- 100*(nrow(sola[sola$Kingdom=="Unknown",]))/nrow(sola)
UK_sola_S <- 100*(nrow(sola[sola$Supergroup=="Unknown",]))/nrow(sola)
UK_sola_D <- 100*(nrow(sola[sola$Division=="Unknown",]))/nrow(sola)
UK_sola_C <- 100*(nrow(sola[sola$Class=="Unknown",]))/nrow(sola)
UK_sola_O <- 100*(nrow(sola[sola$Order=="Unknown",]))/nrow(sola)
UK_sola_F <- 100*(nrow(sola[sola$Family=="Unknown",]))/nrow(sola)
UK_sola_G <- 100*(nrow(sola[sola$Genus=="Unknown",]))/nrow(sola)
UK_sola_Sp <- 100*(nrow(sola[sola$Species=="Unknown",]))/nrow(sola)

# Malaspina
mal <- subset(tax_all, tax_all$ASV %like% "ASV_Mal_")

UK_mal_K <- 100*(nrow(mal[mal$Kingdom=="Unknown",]))/nrow(mal)
UK_mal_S <- 100*(nrow(mal[mal$Supergroup=="Unknown",]))/nrow(mal)
UK_mal_D <- 100*(nrow(mal[mal$Division=="Unknown",]))/nrow(mal)
UK_mal_C <- 100*(nrow(mal[mal$Class=="Unknown",]))/nrow(mal)
UK_mal_O <- 100*(nrow(mal[mal$Order=="Unknown",]))/nrow(mal)
UK_mal_F <- 100*(nrow(mal[mal$Family=="Unknown",]))/nrow(mal)
UK_mal_G <- 100*(nrow(mal[mal$Genus=="Unknown",]))/nrow(mal)
UK_mal_Sp <- 100*(nrow(mal[mal$Species=="Unknown",]))/nrow(mal)

# MOOSE
moo <- subset(tax_all, tax_all$ASV %like% "ASV_Moo_")

UK_moo_K <- 100*(nrow(moo[moo$Kingdom=="Unknown",]))/nrow(moo)
UK_moo_S <- 100*(nrow(moo[moo$Supergroup=="Unknown",]))/nrow(moo)
UK_moo_D <- 100*(nrow(moo[moo$Division=="Unknown",]))/nrow(moo)
UK_moo_C <- 100*(nrow(moo[moo$Class=="Unknown",]))/nrow(moo)
UK_moo_O <- 100*(nrow(moo[moo$Order=="Unknown",]))/nrow(moo)
UK_moo_F <- 100*(nrow(moo[moo$Family=="Unknown",]))/nrow(moo)
UK_moo_G <- 100*(nrow(moo[moo$Genus=="Unknown",]))/nrow(moo)
UK_moo_Sp <- 100*(nrow(moo[moo$Species=="Unknown",]))/nrow(moo)

# Create dataframe for plot
Dataset<-c(rep("BioMarKs",8), rep("ASTAN",8), rep("BBMO",8), rep("SOLA",8), rep("Malaspina",8), rep("MOOSE",8))

Unknowns<-c(UK_biom_K, UK_biom_S, UK_biom_D, UK_biom_C, UK_biom_O, UK_biom_F, UK_biom_G, UK_biom_Sp,
            UK_astan_K, UK_astan_S, UK_astan_D, UK_astan_C, UK_astan_O, UK_astan_F, UK_astan_G, UK_astan_Sp,
            UK_bbmo_K, UK_bbmo_S, UK_bbmo_D, UK_bbmo_C, UK_bbmo_O, UK_bbmo_F, UK_bbmo_G, UK_bbmo_Sp,
            UK_sola_K, UK_sola_S, UK_sola_D, UK_sola_C, UK_sola_O, UK_sola_F, UK_sola_G, UK_sola_Sp,
            UK_mal_K, UK_mal_S, UK_mal_D, UK_mal_C, UK_mal_O, UK_mal_F, UK_mal_G, UK_mal_Sp,
            UK_moo_K, UK_moo_S, UK_moo_D, UK_moo_C, UK_moo_O, UK_moo_F, UK_moo_G, UK_moo_Sp)

Taxo_level<-rep(c("Kingdom", "Supergroup", "Division", "Class", "Order","Family","Genus","Species"),6)
            
don_PR2_div<-data.frame(Dataset, Unknowns, Taxo_level)

don_PR2_div$Taxo_level <- factor(don_PR2_div$Taxo_level,levels = c("Kingdom", "Supergroup", "Division", "Class", "Order","Family","Genus","Species"))
don_PR2_div$Dataset <- factor(don_PR2_div$Dataset ,levels = c("BioMarKs", "ASTAN", "BBMO", "SOLA","Malaspina","MOOSE"))

# Plot
p1 <- ggplot(don_PR2_div, aes(fill=Dataset, y=Unknowns, x=Taxo_level)) + 
  geom_bar(position="dodge", stat="identity", colour="black") +
  geom_hline(aes(yintercept=50.00), color="red", linetype="dashed", size=0.5) +
  theme_linedraw() +
  facet_grid(~Taxo_level, scales = "free_x") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_uchicago(palette ="default", alpha = 1) +
  ylab("Number of unassigned metabarcodes (%)")

plot(p1)
```

# Relative abundance of unassigned metabarcodes

Figure 1 (A)

```{r}
## Count abundance of unknown metabarcodes

##-- BIOMARKS --##
# Read ASV table
ASV_tax_N=read.csv("/shared/projects/formaldark/R_igraph/Final_files/ASV_BioMarKs_final.csv",h=T, sep=",",row.names=1)

# Subset table with unknown metabarcodes at each taxonomic level:
#- Kingdom level -#
Kingdom <- subset(ASV_tax_N, Kingdom == "Unknown")

# Get abundance of unknown metabarcodes  
# Get sum of unknown abundance per sample
s <- colSums(Kingdom[,11:125])
# Get mean unknown abundance 
Kingdom_bi <- mean(s)*100

#- Supergroup level -#
Supergroup <- subset(ASV_tax_N, Supergroup == "Unknown")
s <- colSums(Supergroup[,11:125])
Supergroup_bi <- mean(s)*100

#- Division level -#
Division <- subset(ASV_tax_N, Division == "Unknown")
s <- colSums(Division[,11:125])
Division_bi <- mean(s)*100

#- Class level -#
Class <- subset(ASV_tax_N, Class == "Unknown")
s <- colSums(Class[,11:125])
Class_bi <- mean(s)*100

#- Order level -#
Order <- subset(ASV_tax_N, Order == "Unknown")
s <- colSums(Order[,11:125])
Order_bi <- mean(s)*100

#- Family level -#
Family <- subset(ASV_tax_N, Family == "Unknown")
s <- colSums(Family[,11:125])
Family_bi <- mean(s)*100

#- Genus level -#
Genus <- subset(ASV_tax_N, Genus == "Unknown")
s <- colSums(Genus[,11:125])
Genus_bi <- mean(s)*100

#- Species level -#
Species <- subset(ASV_tax_N, Species == "Unknown")
s <- colSums(Species[,11:125])
Species_bi <- mean(s)*100

##-- BBMO --##
# Read ASV table
ASV_tax_N=read.csv("ASV_BBMO_final.csv",h=T, sep=",",row.names=1)

# Subset table with unknown metabarcodes at each taxonomic level:
#- Kingdom level -#
Kingdom <- subset(ASV_tax_N, Kingdom == "Unknown")

# Get abundance of unknown metabarcodes  
# Get sum of unknown abundance per sample
s <- colSums(Kingdom[,11:337])
# Get mean unknown abundance 
Kingdom_bb<-mean(s)*100

#- Supergroup level -#
Supergroup <- subset(ASV_tax_N, Supergroup == "Unknown")
s <- colSums(Supergroup[,11:337])
Supergroup_bb <- mean(s)*100

#- Division level -#
Division <- subset(ASV_tax_N, Division == "Unknown")
s <- colSums(Division[,11:337])
Division_bb <- mean(s)*100

#- Class level -#
Class <- subset(ASV_tax_N, Class == "Unknown")
s <- colSums(Class[,11:337])
Class_bb <- mean(s)*100

#- Order level -#
Order <- subset(ASV_tax_N, Order == "Unknown")
s <- colSums(Order[,11:337])
Order_bb <- mean(s)*100

#- Family level -#
Family <- subset(ASV_tax_N, Family == "Unknown")
s <- colSums(Family[,11:337])
Family_bb <- mean(s)*100

#- Genus level -#
Genus <- subset(ASV_tax_N, Genus == "Unknown")
s <- colSums(Genus[,11:337])
Genus_bb <- mean(s)*100

#- Species level -#
Species <- subset(ASV_tax_N, Species == "Unknown")
s <- colSums(Species[,11:337])
Species_bb <- mean(s)*100

##-- MALASPINA --##
# Read ASV table
ASV_tax_N=read.csv("ASV_Malaspina_final.csv",h=T, sep=",",row.names=1)

# Subset table with unknown metabarcodes at each taxonomic level:
#- Kingdom level -#
Kingdom <- subset(ASV_tax_N, Kingdom == "Unknown")

# Get abundance of unknown metabarcodes  
# Get sum of unknown abundance per sample
s <- colSums(Kingdom[,11:299])
# Get mean unknown abundance 
Kingdom_ma<-mean(s)*100

#- Supergroup level -#
Supergroup <- subset(ASV_tax_N, Supergroup == "Unknown")
s <- colSums(Supergroup[,11:299])
Supergroup_ma<-mean(s)*100

#- Division level -#
Division <- subset(ASV_tax_N, Division == "Unknown")
s <- colSums(Division[,11:299])
Division_ma<-mean(s)*100

#- Class level -#
Class <- subset(ASV_tax_N, Class == "Unknown")
s <- colSums(Class[,11:299])
Class_ma<-mean(s)*100

#- Order level -#
Order <- subset(ASV_tax_N, Order == "Unknown")
s <- colSums(Order[,11:299])
Order_ma<-mean(s)*100

#- Family level -#
Family <- subset(ASV_tax_N, Family == "Unknown")
s <- colSums(Family[,11:299])
Family_ma<-mean(s)*100

#- Genus level -#
Genus <- subset(ASV_tax_N, Genus == "Unknown")
s <- colSums(Genus[,11:299])
Genus_ma<-mean(s)*100

#- Species level -#
Species <- subset(ASV_tax_N, Species == "Unknown")
s <- colSums(Species[,11:299])
Species_ma<-mean(s)*100

##-- MOOSE --##
# Read ASV table
ASV_tax_N=read.csv("ASV_MOOSE_final.csv",h=T, sep=",",row.names=1)

# Subset table with unknown metabarcodes at each taxonomic level:
#- Kingdom level -#
Kingdom <- subset(ASV_tax_N, Kingdom == "Unknown")

# Get abundance of unknown metabarcodes  
# Get sum of unknown abundance per sample
s <- colSums(Kingdom[,11:283])
# Get mean unknown abundance 
Kingdom_mo<-mean(s)*100

#- Supergroup level -#
Supergroup <- subset(ASV_tax_N, Supergroup == "Unknown")
s <- colSums(Supergroup[,11:283])
Supergroup_mo<-mean(s)*100

#- Division level -#
Division <- subset(ASV_tax_N, Division == "Unknown")
s <- colSums(Division[,11:283])
Division_mo<-mean(s)*100

#- Class level -#
Class <- subset(ASV_tax_N, Class == "Unknown")
s <- colSums(Class[,11:283])
Class_mo<-mean(s)*100

#- Order level -#
Order <- subset(ASV_tax_N, Order == "Unknown")
s <- colSums(Order[,11:283])
Order_mo<-mean(s)*100

#- Family level -#
Family <- subset(ASV_tax_N, Family == "Unknown")
s <- colSums(Family[,11:283])
Family_mo<-mean(s)*100

#- Genus level -#
Genus <- subset(ASV_tax_N, Genus == "Unknown")
s <- colSums(Genus[,11:283])
Genus_mo<-mean(s)*100

#- Species level -#
Species <- subset(ASV_tax_N, Species == "Unknown")
s <- colSums(Species[,11:283])
Species_mo<-mean(s)*100

##-- SOLA --##
# Read ASV table
ASV_tax_N=read.csv("ASV_SOLA_final.csv",h=T, sep=",",row.names=1)

# Subset table with unknown metabarcodes at each taxonomic level:
#- Kingdom level -#
Kingdom <- subset(ASV_tax_N, Kingdom == "Unknown")

# Get abundance of unknown metabarcodes  
# Get sum of unknown abundance per sample
s <- colSums(Kingdom[,11:158])
# Get mean unknown abundance 
Kingdom_so<-mean(s)*100

#- Supergroup level -#
Supergroup <- subset(ASV_tax_N, Supergroup == "Unknown")
s <- colSums(Supergroup[,11:158])
Supergroup_so<-mean(s)*100

#- Division level -#
Division <- subset(ASV_tax_N, Division == "Unknown")
s <- colSums(Division[,11:158])
Division_so<-mean(s)*100

#- Class level -#
Class <- subset(ASV_tax_N, Class == "Unknown")
s <- colSums(Class[,11:158])
Class_so<-mean(s)*100

#- Order level -#
Order <- subset(ASV_tax_N, Order == "Unknown")
s <- colSums(Order[,11:158])
Order_so<-mean(s)*100

#- Family level -#
Family <- subset(ASV_tax_N, Family == "Unknown")
s <- colSums(Family[,11:158])
Family_so<-mean(s)*100

#- Genus level -#
Genus <- subset(ASV_tax_N, Genus == "Unknown")
s <- colSums(Genus[,11:158])
Genus_so<-mean(s)*100

#- Species level -#
Species <- subset(ASV_tax_N, Species == "Unknown")
s <- colSums(Species[,11:158])
Species_so<-mean(s)*100

##-- ASTAN --##
# Read ASV table
ASV_tax_N=read.csv("ASV_ASTAN_final.csv",h=T, sep=",",row.names=1)

# Subset table with unknown metabarcodes at each taxonomic level:
#- Kingdom level -#
Kingdom <- subset(ASV_tax_N, Kingdom == "Unknown")

# Get abundance of unknown metabarcodes  
# Get sum of unknown abundance per sample
s <- colSums(Kingdom[,11:384])

# Get mean unknown abundance 
Kingdom_as<-mean(s)*100

#- Supergroup level -#
Supergroup <- subset(ASV_tax_N, Supergroup == "Unknown")
s <- colSums(Supergroup[,11:384])
Supergroup_as<-mean(s)*100

#- Division level -#
Division <- subset(ASV_tax_N, Division == "Unknown")
s <- colSums(Division[,11:384])
Division_as<-mean(s)*100

#- Class level -#
Class <- subset(ASV_tax_N, Class == "Unknown")
s <- colSums(Class[,11:384])
Class_as<-mean(s)*100

#- Order level -#
Order <- subset(ASV_tax_N, Order == "Unknown")
s <- colSums(Order[,11:384])
Order_as<-mean(s)*100

#- Family level -#
Family <- subset(ASV_tax_N, Family == "Unknown")
s <- colSums(Family[,11:384])
Family_as<-mean(s)*100

#- Genus level -#
Genus <- subset(ASV_tax_N, Genus == "Unknown")
s <- colSums(Genus[,11:384])
Genus_as<-mean(s)*100

#- Species level -#
Species <- subset(ASV_tax_N, Species == "Unknown")
s <- colSums(Species[,11:384])
Species_as<-mean(s)*100
###################
```

```{r}
# Create dataframe for plot
Dataset<-c(rep("BioMarKs",8), rep("ASTAN",8), rep("BBMO",8), rep("SOLA",8), rep("Malaspina",8), rep("MOOSE",8))

Unknowns<-c(Kingdom_bi, Supergroup_bi, Division_bi, Class_bi, Order_bi, Family_bi, Genus_bi, Species_bi,
            Kingdom_as, Supergroup_as, Division_as, Class_as, Order_as, Family_as, Genus_as, Species_as,
            Kingdom_bb, Supergroup_bb, Division_bb, Class_bb, Order_bb, Family_bb, Genus_bb, Species_bb,
            Kingdom_so, Supergroup_so, Division_so, Class_so, Order_so, Family_so, Genus_so, Species_so,
            Kingdom_ma, Supergroup_ma, Division_ma, Class_ma, Order_ma, Family_ma, Genus_ma, Species_ma,
            Kingdom_mo, Supergroup_mo, Division_mo, Class_mo, Order_mo, Family_mo, Genus_mo, Species_mo)

Taxo_level<-rep(c("Kingdom", "Supergroup", "Division", "Class", "Order","Family","Genus","Species"),6)
            
don_PR2_abund<-data.frame(Dataset, Unknowns, Taxo_level)

don_PR2_abund$Taxo_level <- factor(don_PR2_abund$Taxo_level,levels = c("Kingdom", "Supergroup", "Division", "Class", "Order","Family","Genus","Species"))
don_PR2_abund$Dataset <- factor(don_PR2_abund$Dataset ,levels = c("BioMarKs", "ASTAN", "BBMO", "SOLA","Malaspina","MOOSE"))

# Plot
p2 <- ggplot(don_PR2_abund, aes(fill=Dataset, y=Unknowns, x=Taxo_level)) + 
  geom_bar(position="dodge", stat="identity", colour="black") +
  geom_hline(aes(yintercept=50.00), color="red", linetype="dashed", size=0.5) +
  theme_linedraw() +
  facet_grid(~Taxo_level, scales = "free_x") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_uchicago(palette ="default", alpha = 1) +
  ylab("Abundance of unassigned metabarcodes (%)")

plot(p2)
```


# Kingdom-level unassigned metabarcodes

The distribution of the 628 unassigned metabarcodes at kingodm level was explored across locations.

```{r}
d=read.csv("/shared/projects/formaldark/Silva/NA_silva_metadata_2_U.csv", h=T, sep=",")

d[d=="Unknown"] <- "Unassigned"

world <- map_data("world", bg='blue')

MAPU <- ggplot() + 
  geom_polygon(data = world, aes(x = long, y = lat, group = group), color = "wheat3", fill = "wheat3") +
  geom_point(data = d, aes(x = Longitude, y = Latitude, color = Kingdom), size = 1.2) +
  coord_fixed(1, xlim = c(-180, 180), ylim = c(-90, 90)) + theme_linedraw() + scale_colour_manual(values = c("Unassigned"="black")) +
  ylab("Latitude") + xlab("Longitude") + theme(axis.text=element_text(size=13))+ theme(legend.title = element_text(size = 20), legend.text = element_text(size = 20), legend.position = "top")

plot(MAPU)

# Distribution of unassigned sequences across datasets
Dataset<-c("BiomarKs", "ASTAN", "BBMO", "SOLA", "Malaspina", "MOOSE")

seq <- c(nrow(d[d$Dataset.y %like% "BioMarKs",]), 
nrow(d[d$Dataset.y =="ASTAN",]), 
nrow(d[d$Dataset.y =="BBMO",]), 
nrow(d[d$Dataset.y =="SOLA",]), 
nrow(d[d$Dataset.y =="Malaspina",]), 
nrow(d[d$Dataset.y =="MOOSE",]))

df <- data.frame(Dataset, seq)

df$Dataset <- factor(df$Dataset ,levels = c("BiomarKs", "ASTAN", "BBMO", "SOLA","Malaspina","MOOSE"))

b1 <- ggplot(df, aes(y=seq, x=Dataset, fill=Dataset)) + 
  geom_bar(stat="identity", colour="black") + 
  theme_minimal() +
  scale_fill_uchicago(palette ="default", alpha = 1) +
  theme(axis.ticks.x=element_blank(), axis.title.x=element_blank()) +
  ylab("Number of metabarcodes") + 
  theme(legend.title = element_text(face="bold"))

plot(b1)

# % of unassigned sequences at Kingdom level found in deep Malaspina samples
100*nrow(d[d$Dataset.y =="Malaspina",])/nrow(d)


# Distribution of unassigned sequences across Malaspina depths
Depth_type2 <- c(rep(0, nrow(d)))
d <- cbind(d, Depth_type2)

d$Depth_type2[d$Depth <= 5] <- "SRF"
d$Depth_type2[d$Depth > 5] <- "DCM" 
d$Depth_type2[d$Depth >= 200] <- "MESO"
d$Depth_type2[d$Depth >= 1000] <- "BATHY"

dmal <- d[d$Dataset.y=="Malaspina",]

Depth <- c("SRF", "DCM", "MESO", "BATHY")

value <- c(nrow(dmal[dmal$Depth_type2 == "SRF",]), 
nrow(dmal[dmal$Depth_type2 =="DCM",]), 
nrow(dmal[dmal$Depth_type2 =="MESO",]), 
nrow(dmal[dmal$Depth_type2 =="BATHY",])) 

df2 <- data.frame(Depth, value)

df2$Depth <- factor(df2$Depth ,levels = c("SRF", "DCM", "MESO", "BATHY"))

b2 <- ggplot(df2, aes(y=value, x=Depth, fill=Depth)) + 
  geom_bar(stat="identity", colour="black") + 
  theme_minimal() +
  scale_fill_manual(values=c("yellow","orange","purple","navy")) +
  theme(axis.ticks.x=element_blank(), axis.title.x=element_blank()) +
  ylab("Number of metabarcodes") + 
  theme(legend.title = element_text(face="bold"))

plot(b2)

# % of unassigned sequences at Kingdom level found in deep Malaspina samples (>1000m)
100*nrow(dmal[dmal$Depth_type2 =="BATHY",])/nrow(d)
```

## 4. Protist divisions: diversity and abundnace of unassigned sequences at genus level

# Diversity

Quantification of Dinophyceae and Syndiniales among Dinoflagellata done also in following code.

```{r}
# Read taxonomy table 
d=read.csv("/shared/projects/formaldark/Data_stageM2/All_seq_taxTable_noAB_PR2_EKsilva.csv", h=T, sep=";",stringsAsFactors = TRUE)

# Explore the Divisions to which genus unknown metabarcodes belong across datasets
H <- d[d$Genus == "Unknown", ]

## ASTAN ##
A <- H[H$ASV %like% "ASV_Ast",]

# Number of protist divisions presenting unknown diversity 
df_div_as <- data.frame(sort((summary(A$Division)/sum(summary(A$Division)))*100))

# Quantification of classes among Dinoflagellata
D <- (A[A$Division=="Dinoflagellata",])
df_div_class_as <- data.frame((summary(D$Class)/nrow(D)*100))

# Quantification of knowns and unknowns among Dinophyceae and Syndiniales
AA <- d[d$ASV %like% "ASV_Ast",]

dinop <- AA[AA$Class=="Dinophyceae",]
Ast_dinop_k <- (nrow(dinop[dinop$Genus!="Unknown",])/nrow(dinop))*100
Ast_dinop_uk <- 100-Ast_dinop_k

synd <- AA[AA$Class=="Syndiniales",]
Ast_synd_k <- (nrow(synd[synd$Genus!="Unknown",])/nrow(synd))*100
Ast_synd_uk <- 100-Ast_synd_k

## BioMarKs ##
A <- H[H$ASV %like% "ASV_Biom",]

# Number of protist divisions presenting unknown diversity 
df_div_bi <- data.frame(sort((summary(A$Division)/sum(summary(A$Division)))*100))

# Quantification of Syndiales and Dinophyceae among Dinoflagellata
D <- (A[A$Division=="Dinoflagellata",])
df_div_class_bi <- data.frame((summary(D$Class)/nrow(D)*100))

# Quantification of knowns and unknowns among Dinophyceae and Syndiniales
AA <- d[d$ASV %like% "ASV_Biom",]

dinop <- AA[AA$Class=="Dinophyceae",]
Biom_dinop_k <- (nrow(dinop[dinop$Genus!="Unknown",])/nrow(dinop))*100
Biom_dinop_uk <- 100-Biom_dinop_k

synd <- AA[AA$Class=="Syndiniales",]
Biom_synd_k <- (nrow(synd[synd$Genus!="Unknown",])/nrow(synd))*100
Biom_synd_uk <- 100-Biom_synd_k

## BBMO ##
A <- H[H$ASV %like% "ASV_BBMO",]

# Number of protist divisions presenting unknown diversity 
df_div_bb <- data.frame(sort((summary(A$Division)/sum(summary(A$Division)))*100))

# Quantification of Syndiales and Dinophyceae among Dinoflagellata
D <- (A[A$Division=="Dinoflagellata",])
df_div_class_bb <- data.frame((summary(D$Class)/nrow(D)*100))

# Quantification of knowns and unknowns among Dinophyceae and Syndiniales
AA <- d[d$ASV %like% "ASV_BBMO",]

dinop <- AA[AA$Class=="Dinophyceae",]
BBMO_dinop_k <- (nrow(dinop[dinop$Genus!="Unknown",])/nrow(dinop))*100
BBMO_dinop_uk <- 100-BBMO_dinop_k

synd <- AA[AA$Class=="Syndiniales",]
BBMO_synd_k <- (nrow(synd[synd$Genus!="Unknown",])/nrow(synd))*100
BBMO_synd_uk <- 100-BBMO_synd_k

## Sola ##
A <- H[H$ASV %like% "ASV_Sol",]

# Number of protist divisions presenting unknown diversity 
df_div_so <- data.frame(sort((summary(A$Division)/sum(summary(A$Division)))*100))

# Quantification of Syndiales and Dinophyceae among Dinoflagellata
D <- (A[A$Division=="Dinoflagellata",])
df_div_class_so <- data.frame((summary(D$Class)/nrow(D)*100))

# Quantification of knowns and unknowns among Dinophyceae and Syndiniales
AA <- d[d$ASV %like% "ASV_Sol",]

dinop <- AA[AA$Class=="Dinophyceae",]
Sol_dinop_k <- (nrow(dinop[dinop$Genus!="Unknown",])/nrow(dinop))*100
Sol_dinop_uk <- 100-Sol_dinop_k

synd <- AA[AA$Class=="Syndiniales",]
Sol_synd_k <- (nrow(synd[synd$Genus!="Unknown",])/nrow(synd))*100
Sol_synd_uk <- 100-Sol_synd_k

## Malaspina ##
A <- H[H$ASV %like% "ASV_Mal",]

# Number of protist divisions presenting unknown diversity 
df_div_ma <- data.frame(sort((summary(A$Division)/sum(summary(A$Division)))*100))

# Quantification of Syndiales and Dinophyceae among Dinoflagellata
D <- (A[A$Division=="Dinoflagellata",])
df_div_class_ma <- data.frame((summary(D$Class)/nrow(D)*100))

# Quantification of knowns and unknowns among Dinophyceae and Syndiniales
AA <- d[d$ASV %like% "ASV_Mal",]

dinop <- AA[AA$Class=="Dinophyceae",]
Mal_dinop_k <- (nrow(dinop[dinop$Genus!="Unknown",])/nrow(dinop))*100
Mal_dinop_uk <- 100-Mal_dinop_k

synd <- AA[AA$Class=="Syndiniales",]
Mal_synd_k <- (nrow(synd[synd$Genus!="Unknown",])/nrow(synd))*100
Mal_synd_uk <- 100-Mal_synd_k

## MOOSE ##
A <- H[H$ASV %like% "ASV_Moo",]

# Number of protist divisions presenting unknown diversity 
df_div_mo <- data.frame(sort((summary(A$Division)/sum(summary(A$Division)))*100))

# Quantification of Syndiales and Dinophyceae among Dinoflagellata
D <- (A[A$Division=="Dinoflagellata",])
df_div_class_mo <- data.frame((summary(D$Class)/nrow(D)*100))

# Quantification of knowns and unknowns among Dinophyceae and Syndiniales
AA <- d[d$ASV %like% "ASV_Moo",]

dinop <- AA[AA$Class=="Dinophyceae",]
Moo_dinop_k <- (nrow(dinop[dinop$Genus!="Unknown",])/nrow(dinop))*100
Moo_dinop_uk <- 100-Moo_dinop_k

synd <- AA[AA$Class=="Syndiniales",]
Moo_synd_k <- (nrow(synd[synd$Genus!="Unknown",])/nrow(synd))*100
Moo_synd_uk <- 100-Moo_synd_k
```

Figure S4(A, top)

```{r}
# Read data
don=read.csv("/shared/projects/formaldark/R_igraph/Final_files/Fig_S4A_division_abund_diversity.csv",h=T, sep=";",stringsAsFactors = TRUE)

# Order columns in data frame
don$Dataset <- factor(don$Dataset,levels = c("BioMarKs","ASTAN","BBMO","SOLA", "Malaspina","MOOSE"))
don$Division <- factor(don$Division,levels = c("Dinoflagellata","Ochrophyta","Ciliophora","Radiolaria",
                                               "Cercozoa","Cryptophyta","Opalozoa","Sagenista","Other"))
# Stacked barplot
p5<-ggplot(don, aes(fill=Division, y=Unknowns_div, x=Dataset)) + 
  geom_bar(position="fill", stat="identity", colour="black") +
  theme_linedraw() +
  facet_grid(~Dataset, scales = "free_x") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_manual(values = c("navy", "darkorange4","darkred","magenta4","darkolivegreen1","orangered",
                               "steelblue1", "tan1" ,"black")) +
  ylab("Number of unassigned metabarcodes (%)")

plot(p5)
```

# Abundance 

Abundance and alpha-diversity measures are calculated in the same code.

```{r}
## Count abundance of unknown metabarcodes at genus level in each Division
##-- BIOMARKS --##
# Read ASV table
ASV_tax_N=read.csv("/shared/projects/formaldark/R_igraph/Final_files/ASV_BioMarKs_final.csv",h=T, sep=",",row.names=1,stringsAsFactors = T)

### Shannon α-div within Dinoflagellata, Ochrophyta, Ciliophora and Radiolaria
# Keep Dino Division
Dino <- ASV_tax_N[ASV_tax_N$Division=="Dinoflagellata",]
Dino <- droplevels(Dino)

#-#
# Quantification of Classes among Dinoflagellata
abund<-0
class<-0
for (i in levels(Dino$Class)) {
  cl <- Dino[Dino$Class == i, ]
  s_cl <- colSums(cl[,11:125])
  perc <- (s_cl/colSums(Dino[,11:125]))*100
  m <- mean(perc)
  abund <- c(abund,as.numeric(paste(m)))
  class <- c(class,i)
}

dino_biom <- data.frame(abund,class)

# Quantification of known and unknowns among Syndiniales and Dinophyceae
S <- ASV_tax_N[ASV_tax_N$Class=="Syndiniales",]
DD <- ASV_tax_N[ASV_tax_N$Class=="Dinophyceae",]

K_S_biom <- S[S$Genus!="Unknown",]
K_S_biom <- mean(data.frame((colSums(K_S_biom[,11:125],)/colSums(S[,11:125],))*100)[,1])
UK_S_biom <- S[S$Genus=="Unknown",]
UK_S_biom <- mean(data.frame((colSums(UK_S_biom[,11:125],)/colSums(S[,11:125],))*100)[,1])

K_DD_biom <- DD[DD$Genus!="Unknown",]
K_DD_biom <- mean(data.frame(((colSums(K_DD_biom[,11:125],)/colSums(DD[,11:125],))*100))[,1])
UK_DD_biom <- DD[DD$Genus=="Unknown",]
UK_DD_biom <- mean(data.frame(((colSums(UK_DD_biom[,11:125],)/colSums(DD[,11:125],))*100))[,1])
#-#

# Alpha diversity of known, unknown and all Dinoflagellata
Genus_unknown <- subset(Dino, Genus == "Unknown")
Genus_dino_alpha_unknown <- data.frame(Genus_unknown[,11:125])

Genus_known <- subset(Dino, Genus != "Unknown")
Genus_dino_alpha_known <- data.frame(Genus_known[,11:125])

Genus_dino_alpha_all <- data.frame(Dino[,11:125])

# Shannon diversity index 
dino_div_biom_unknown <- data.frame(diversity(Genus_dino_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",115)
shannon_biomarks_unknown <- cbind(dino_div_biom_unknown,Group)
names(shannon_biomarks_unknown)[1]<-paste("Shannon")

dino_div_biom_known <- data.frame(diversity(Genus_dino_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",115)
shannon_biomarks_known <- cbind(dino_div_biom_known,Group)
names(shannon_biomarks_known)[1]<-paste("Shannon")

dino_div_biom_all <- data.frame(diversity(Genus_dino_alpha_all, index = "shannon",MARGIN=2, ))
Group <- rep("Dinoflagellata",115)
shannon_biomarks_all <- cbind(dino_div_biom_all,Group)
names(shannon_biomarks_all)[1]<-paste("Shannon")

# Keep Ochro Division
# Subset table with unknown metabarcodes at genus level:
Genus <- subset(ASV_tax_N, Genus == "Unknown")
Genus <- droplevels(Genus)

Genus_ochro_unknown<- Genus[Genus$Division=="Ochrophyta",]
Genus_ochro_alpha_unknown <- data.frame(Genus_ochro_unknown[,11:125])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_ochro_known <- Genus_known[Genus_known$Division=="Ochrophyta",]
Genus_ochro_alpha_known <- data.frame(Genus_ochro_known[,11:125])

Genus_ochro_all <- subset(ASV_tax_N, Division=="Ochrophyta")
Genus_ochro_alpha_all <- data.frame(Genus_ochro_all[,11:125])

# Shannon diversity index 
ochro_div_biom_unknown <- data.frame(diversity(Genus_ochro_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",115)
ochro_biomarks_unknown <- cbind(ochro_div_biom_unknown,Group)
names(ochro_biomarks_unknown)[1]<-paste("Shannon")
shannon_biomarks_unknown <- rbind(shannon_biomarks_unknown,ochro_biomarks_unknown)

ochro_div_biom_known <- data.frame(diversity(Genus_ochro_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",115)
ochro_biomarks_known <- cbind(ochro_div_biom_known,Group)
names(ochro_biomarks_known)[1]<-paste("Shannon")
shannon_biomarks_known <- rbind(shannon_biomarks_known,ochro_biomarks_known)

ochro_div_biom_all <- data.frame(diversity(Genus_ochro_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",115)
ochro_biomarks_all <- cbind(ochro_div_biom_all,Group)
names(ochro_biomarks_all)[1]<-paste("Shannon")
shannon_biomarks_all <- rbind(shannon_biomarks_all,ochro_biomarks_all)

# Keep Cilio Division
Genus_cilio_unknown <- Genus[Genus$Division=="Ciliophora",]
Genus_cilio_alpha_unknown <- data.frame(Genus_cilio_unknown[,11:125])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_cilio_known <- Genus_known[Genus_known$Division=="Ciliophora",]
Genus_cilio_alpha_known <- data.frame(Genus_cilio_known[,11:125])

Genus_cilio_all <- subset(ASV_tax_N, Division=="Ciliophora")
Genus_cilio_alpha_all <- data.frame(Genus_cilio_all[,11:125])

# Shannon diversity index 
cilio_div_biom_unknown <- data.frame(diversity(Genus_cilio_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",115)
cilio_biomarks_unknown <- cbind(cilio_div_biom_unknown,Group)
names(cilio_biomarks_unknown)[1]<-paste("Shannon")
shannon_biomarks_unknown <- rbind(shannon_biomarks_unknown,cilio_biomarks_unknown)

cilio_div_biom_known <- data.frame(diversity(Genus_cilio_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",115)
cilio_biomarks_known <- cbind(cilio_div_biom_known,Group)
names(cilio_biomarks_known)[1]<-paste("Shannon")
shannon_biomarks_known <- rbind(shannon_biomarks_known,cilio_biomarks_known)

cilio_div_biom_all <- data.frame(diversity(Genus_cilio_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",115)
cilio_biomarks_all <- cbind(cilio_div_biom_all,Group)
names(cilio_biomarks_all)[1]<-paste("Shannon")
shannon_biomarks_all <- rbind(shannon_biomarks_all,cilio_biomarks_all)

# Keep Rad Division
Genus_rad_unknown <- Genus[Genus$Division=="Radiolaria",]
Genus_rad_alpha_unknown <- data.frame(Genus_rad_unknown[,11:125])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_rad_known <- Genus_known[Genus_known$Division=="Radiolaria",]
Genus_rad_alpha_known <- data.frame(Genus_rad_known[,11:125])

Genus_rad_all <- subset(ASV_tax_N, Division=="Radiolaria")
Genus_rad_alpha_all <- data.frame(Genus_rad_all[,11:125])

# Shannon diversity index 
rad_div_biom_unknown <- data.frame(diversity(Genus_rad_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Radiolaria",115)
rad_biomarks_unknown <- cbind(rad_div_biom_unknown,Group)
names(rad_biomarks_unknown)[1]<-paste("Shannon")
shannon_biomarks_unknown <- rbind(shannon_biomarks_unknown,rad_biomarks_unknown)

rad_div_biom_known <-  data.frame(diversity(Genus_rad_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Radiolaria",115)
rad_biomarks_known <- data.frame(rad_div_biom_known,Group)
names(rad_biomarks_known)[1]<-paste("Shannon")
shannon_biomarks_known <- rbind(shannon_biomarks_known,rad_biomarks_known)

rad_div_biom_all <- data.frame(diversity(Genus_rad_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Radiolaria",115)
rad_biomarks_all <- cbind(rad_div_biom_all,Group)
names(rad_biomarks_all)[1]<-paste("Shannon")
shannon_biomarks_all <- rbind(shannon_biomarks_all,rad_biomarks_all)

# Keep Crypto Division
Genus_cryp_unknown <- Genus[Genus$Division=="Cryptophyta",]
Genus_cryp_alpha_unknown <- data.frame(Genus_cryp_unknown[,11:125])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_cryp_known <- Genus_known[Genus_known$Division=="Cryptophyta",]
Genus_cryp_alpha_known <- data.frame(Genus_cryp_known[,11:125])

Genus_cryp_all <- subset(ASV_tax_N, Division=="Cryptophyta")
Genus_cryp_alpha_all <- data.frame(Genus_cryp_all[,11:125])

# Shannon diversity index 
cryp_div_biom_unknown <- data.frame(diversity(Genus_cryp_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Cryptophyta",115)
cryp_biomarks_unknown <- cbind(cryp_div_biom_unknown,Group)
names(cryp_biomarks_unknown)[1]<-paste("Shannon")
shannon_biomarks_unknown <- rbind(shannon_biomarks_unknown,cryp_biomarks_unknown)

cryp_div_biom_known <- data.frame(diversity(Genus_cryp_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Cryptophyta",115)
cryp_biomarks_known <- data.frame(cryp_div_biom_known,Group)
names(cryp_biomarks_known)[1]<-paste("Shannon")
shannon_biomarks_known <- rbind(shannon_biomarks_known,cryp_biomarks_known)

cryp_div_biom_all <- data.frame(diversity(Genus_cryp_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Cryptophyta",115)
cryp_biomarks_all <- cbind(cryp_div_biom_all,Group)
names(cryp_biomarks_all)[1]<-paste("Shannon")
shannon_biomarks_all <- rbind(shannon_biomarks_all,cryp_biomarks_all)
###

# Get abundance of unknown metabarcodes  
abund<-0
division<-0
for (i in levels(Genus$Division)) {
  di <- Genus[Genus$Division == i, ]
  s_di <- colSums(di[,11:125])
  perc <- (s_di/colSums(Genus[,11:125]))*100
  m <- mean(perc,na.rm=T)
  abund <- c(abund,as.numeric(paste(m)))
  division <- c(division,i)
}

df_abund_biom <- data.frame(abund,division)

# Biomarks Shannon div
Dataset <- rep("BioMarKs", 575)
shannon_biomarks_unknown <- cbind(shannon_biomarks_unknown,Dataset)
shannon_biomarks_known <- cbind(shannon_biomarks_known,Dataset)
shannon_biomarks_all <- cbind(shannon_biomarks_all,Dataset)


##-- MALASPINA --##
# Read ASV table
ASV_tax_N=read.csv("/shared/projects/formaldark/R_igraph/Final_files/ASV_Malaspina_final.csv",h=T, sep=",",row.names=1, stringsAsFactors = T)

# Subset table with unknown metabarcodes at genus level:
Genus <- subset(ASV_tax_N, Genus == "Unknown")
Genus <- droplevels(Genus)

# Get abundance of unknown metabarcodes  
abund<-0
division<-0
for (i in levels(Genus$Division)) {
  di <- Genus[Genus$Division == i, ]
  s_di <- colSums(di[,11:299])
  perc <- (s_di/colSums(Genus[,11:299]))*100
  m <- mean(perc,na.rm=T)
  abund <- c(abund,as.numeric(paste(m)))
  division <- c(division,i)
}

df_abund_mal <- data.frame(abund,division)

#-#
# Quantification of Syndiales and Dinophyceae among Dinoflagellata
# Keep Dino Division
Dino <- ASV_tax_N[ASV_tax_N$Division=="Dinoflagellata",]
Dino <- droplevels(Dino)
  
#-#
# Quantification of Classes among Dinoflagellata
abund<-0
class<-0
for (i in levels(Dino$Class)) {
  cl <- Dino[Dino$Class == i, ]
  s_cl <- colSums(cl[,11:299])
  perc <- (s_cl/colSums(Dino[,11:299]))*100
  m <- mean(perc,na.rm=T)
  abund <- c(abund,as.numeric(paste(m)))
  class <- c(class,i)
}

dino_ma <- data.frame(abund,class)

### Shannon α-div within Dinoflagellata, Ochrophyta, Ciliophora, Radiolaria and Sagenista
Genus_unknown <- subset(Dino, Genus == "Unknown")
Genus_dino_alpha_unknown <- data.frame(Genus_unknown[,11:299])

Genus_known <- subset(Dino, Genus != "Unknown")
Genus_dino_alpha_known <- data.frame(Genus_known[,11:299])

Genus_dino_alpha_all <- data.frame(Dino[,11:299])

# Quantification of known and unknowns among Syndiniales and Dinophyceae
S <- ASV_tax_N[ASV_tax_N$Class=="Syndiniales",]
DD <- ASV_tax_N[ASV_tax_N$Class=="Dinophyceae",]

K_S_mal <- S[S$Genus!="Unknown",]
K_S_mal <-  mean(na.omit(data.frame((colSums(K_S_mal[,11:299])/colSums(S[,11:299]))*100)[,1]))
UK_S_mal <- S[S$Genus=="Unknown",]
UK_S_mal <- mean(na.omit(data.frame((colSums(UK_S_mal[,11:299])/colSums(S[,11:299]))*100)[,1]))

K_DD_mal <- DD[DD$Genus!="Unknown",]
K_DD_mal <- mean(na.omit(data.frame(((colSums(K_DD_mal[,11:299])/colSums(DD[,11:299]))*100))[,1]))
UK_DD_mal <- DD[DD$Genus=="Unknown",]
UK_DD_mal <- mean(na.omit(data.frame(((colSums(UK_DD_mal[,11:299])/colSums(DD[,11:299]))*100))[,1]))
#-#

# Shannon diversity index 
dino_div_mal_unknown <- data.frame(diversity(Genus_dino_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",289)
shannon_mal_unknown <- cbind(dino_div_mal_unknown,Group)
names(shannon_mal_unknown)[1]<-paste("Shannon")

dino_div_mal_known <- data.frame(diversity(Genus_dino_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",289)
shannon_mal_known <- cbind(dino_div_mal_known,Group)
names(shannon_mal_known)[1]<-paste("Shannon")

dino_div_mal_all <- data.frame(diversity(Genus_dino_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",289)
shannon_mal_all <- cbind(dino_div_mal_all,Group)
names(shannon_mal_all)[1]<-paste("Shannon")

# Keep Ochro Division
Genus_ochro_unknown <- Genus[Genus$Division=="Ochrophyta",]
Genus_ochro_alpha_unknown <- data.frame(Genus_ochro_unknown[,11:299])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_ochro_known <- Genus_known[Genus_known$Division=="Ochrophyta",]
Genus_ochro_alpha_known <- data.frame(Genus_ochro_known[,11:299])

Genus_ochro_all <- subset(ASV_tax_N, Division=="Ochrophyta")
Genus_ochro_alpha_all <- data.frame(Genus_ochro_all[,11:299])

# Shannon diversity index 
ochro_div_mal_unknown <- data.frame(diversity(Genus_ochro_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",289)
ochro_mal_unknown <- cbind(ochro_div_mal_unknown,Group)
names(ochro_mal_unknown)[1]<-paste("Shannon")
shannon_mal_unknown <- rbind(shannon_mal_unknown,ochro_mal_unknown)

ochro_div_mal_known <- data.frame(diversity(Genus_ochro_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",289)
ochro_mal_known <- cbind(ochro_div_mal_known,Group)
names(ochro_mal_known)[1]<-paste("Shannon")
shannon_mal_known <- rbind(shannon_mal_known,ochro_mal_known)

ochro_div_mal_all <- data.frame(diversity(Genus_ochro_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",289)
ochro_mal_all <- cbind(ochro_div_mal_all,Group)
names(ochro_mal_all)[1]<-paste("Shannon")
shannon_mal_all <- rbind(shannon_mal_all,ochro_mal_all)

# Keep Cilio Division
Genus_cilio_unknown <- Genus[Genus$Division=="Ciliophora",]
Genus_cilio_alpha_unknown <- data.frame(Genus_cilio_unknown[,11:299])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_cilio_known <- Genus_known[Genus_known$Division=="Ciliophora",]
Genus_cilio_alpha_known <- data.frame(Genus_cilio_known[,11:299])

Genus_cilio_all <- subset(ASV_tax_N, Division=="Ciliophora")
Genus_cilio_alpha_all <- data.frame(Genus_cilio_all[,11:299])

# Shannon diversity index 
cilio_div_mal_unknown <- data.frame(diversity(Genus_cilio_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",289)
cilio_mal_unknown <- cbind(cilio_div_mal_unknown,Group)
names(cilio_mal_unknown)[1]<-paste("Shannon")
shannon_mal_unknown <- rbind(shannon_mal_unknown,cilio_mal_unknown)

cilio_div_mal_known <- data.frame(diversity(Genus_cilio_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",289)
cilio_mal_known <- cbind(cilio_div_mal_known,Group)
names(cilio_mal_known)[1]<-paste("Shannon")
shannon_mal_known <- rbind(shannon_mal_known,cilio_mal_known)

cilio_div_mal_all <- data.frame(diversity(Genus_cilio_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",289)
cilio_mal_all <- cbind(cilio_div_mal_all,Group)
names(cilio_mal_all)[1]<-paste("Shannon")
shannon_mal_all <- rbind(shannon_mal_all,cilio_mal_all)

# Keep Rad Division
Genus_rad_unknown <- Genus[Genus$Division=="Radiolaria",]
Genus_rad_alpha_unknown <- data.frame(Genus_rad_unknown[,11:299])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_rad_known <- Genus_known[Genus_known$Division=="Radiolaria",]
Genus_rad_alpha_known <- data.frame(Genus_rad_known[,11:299])

Genus_rad_all <- subset(ASV_tax_N, Division=="Radiolaria")
Genus_rad_alpha_all <- data.frame(Genus_rad_all[,11:299])

# Shannon diversity index 
rad_div_mal_unknown <- data.frame(diversity(Genus_rad_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Radiolaria",289)
rad_mal_unknown <- cbind(rad_div_mal_unknown,Group)
names(rad_mal_unknown)[1]<-paste("Shannon")
shannon_mal_unknown <- rbind(shannon_mal_unknown,rad_mal_unknown)

rad_div_mal_known <- data.frame(diversity(Genus_rad_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Radiolaria",289)
rad_mal_known <- cbind(rad_div_mal_known,Group)
names(rad_mal_known)[1]<-paste("Shannon")
shannon_mal_known <- rbind(shannon_mal_known,rad_mal_known)

rad_div_mal_all <- data.frame(diversity(Genus_rad_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Radiolaria",289)
rad_mal_all <- cbind(rad_div_mal_all,Group)
names(rad_mal_all)[1]<-paste("Shannon")
shannon_mal_all <- rbind(shannon_mal_all,rad_mal_all)

# Keep Sagenista Division
Genus_sag_unknown <- Genus[Genus$Division=="Sagenista",]
Genus_sag_alpha_unknown <- data.frame(Genus_sag_unknown[,11:299])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_sag_known <- Genus_known[Genus_known$Division=="Sagenista",]
Genus_sag_alpha_known <- data.frame(Genus_sag_known[,11:299])

Genus_sag_all <- subset(ASV_tax_N, Division=="Sagenista")
Genus_sag_alpha_all <- data.frame(Genus_sag_all[,11:299])

# Shannon diversity index 
sag_div_mal_unknown <- data.frame(diversity(Genus_sag_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Sagenista",289)
sag_mal_unknown <- cbind(sag_div_mal_unknown,Group)
names(sag_mal_unknown)[1]<-paste("Shannon")
shannon_mal_unknown <- rbind(shannon_mal_unknown,sag_mal_unknown)

sag_div_mal_known <- data.frame(diversity(Genus_sag_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Sagenista",289)
sag_mal_known <- cbind(sag_div_mal_known,Group)
names(sag_mal_known)[1]<-paste("Shannon")
shannon_mal_known <- rbind(shannon_mal_known,sag_mal_known)

sag_div_mal_all <- data.frame(diversity(Genus_sag_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Sagenista",289)
sag_mal_all <- cbind(sag_div_mal_all,Group)
names(sag_mal_all)[1]<-paste("Shannon")
shannon_mal_all <- rbind(shannon_mal_all,sag_mal_all)

Dataset <- rep("Malaspina",1445)
shannon_mal_unknown <- cbind(shannon_mal_unknown,Dataset)
shannon_mal_known <- cbind(shannon_mal_known,Dataset)
shannon_mal_all <- cbind(shannon_mal_all,Dataset)
###

##-- MOOSE --##
# Read ASV table
ASV_tax_N=read.csv("/shared/projects/formaldark/R_igraph/Final_files/ASV_MOOSE_final.csv",h=T, sep=",",row.names=1,stringsAsFactors = T)

# Subset table with unknown metabarcodes at genus level:
Genus <- subset(ASV_tax_N, Genus == "Unknown")
Genus <- droplevels(Genus)

# Get abundance of unknown metabarcodes  
abund<-0
division<-0
for (i in levels(Genus$Division)) {
  di <- Genus[Genus$Division == i, ]
  s_di <- colSums(di[,11:283])
  perc <- (s_di/colSums(Genus[,11:283]))*100
  m <- mean(perc,na.rm=T)
  abund <- c(abund,as.numeric(paste(m)))
  division <- c(division,i)
}

df_abund_mo <- data.frame(abund,division)

#-#
# Quantification of Syndiales and Dinophyceae among Dinoflagellata
# Keep Dino Division
Dino <- ASV_tax_N[ASV_tax_N$Division=="Dinoflagellata",]
Dino <- droplevels(Dino)

#-#
# Quantification of Classes among Dinoflagellata
abund<-0
class<-0
for (i in levels(Dino$Class)) {
  cl <- Dino[Dino$Class == i, ]
  s_cl <- colSums(cl[,11:283])
  perc <- (s_cl/colSums(Dino[,11:283]))*100
  m <- mean(perc,na.rm=T)
  abund <- c(abund,as.numeric(paste(m)))
  class <- c(class,i)
}

dino_mo <- data.frame(abund,class)

### Shannon α-div within Dinoflagellata, Ochrophyta, Ciliophora, Radiolaria and Opalozoa
Genus_unknown <- subset(Dino, Genus == "Unknown")
Genus_dino_alpha_unknown <- data.frame(Genus_unknown[,11:283])

Genus_known <- subset(Dino, Genus != "Unknown")
Genus_dino_alpha_known <- data.frame(Genus_known[,11:283])

Genus_dino_alpha_all <- data.frame(Dino[,11:283])

# Quantification of known and unknowns among Syndiniales and Dinophyceae
# Keep Dino Division
Genus_dino <- Genus[Genus$Division=="Dinoflagellata",]

S <- ASV_tax_N[ASV_tax_N$Class=="Syndiniales",]
DD <- ASV_tax_N[ASV_tax_N$Class=="Dinophyceae",]

K_S_moo <- S[S$Genus!="Unknown",]
K_S_moo <-  mean(na.omit(data.frame((colSums(K_S_moo[,11:283])/colSums(S[,11:283]))*100)[,1]))
UK_S_moo <- S[S$Genus=="Unknown",]
UK_S_moo <- mean(na.omit(data.frame((colSums(UK_S_moo[,11:283])/colSums(S[,11:283]))*100)[,1]))

K_DD_moo <- DD[DD$Genus!="Unknown",]
K_DD_moo <- mean(na.omit(data.frame(((colSums(K_DD_moo[,11:283])/colSums(DD[,11:283]))*100))[,1]))
UK_DD_moo <- DD[DD$Genus=="Unknown",]
UK_DD_moo <- mean(na.omit(data.frame(((colSums(UK_DD_moo[,11:283])/colSums(DD[,11:283]))*100))[,1]))
#-#

# Shannon diversity index 
dino_div_moo_unknown <- data.frame(diversity(Genus_dino_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",273)
shannon_moo_unknown <- cbind(dino_div_moo_unknown,Group)
names(shannon_moo_unknown)[1]<-paste("Shannon")

dino_div_moo_known <- data.frame(diversity(Genus_dino_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",273)
shannon_moo_known <- cbind(dino_div_moo_known,Group)
names(shannon_moo_known)[1]<-paste("Shannon")

dino_div_moo_all <- data.frame(diversity(Genus_dino_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",273)
shannon_moo_all <- cbind(dino_div_moo_all,Group)
names(shannon_moo_all)[1]<-paste("Shannon")

# Keep Ochro Division
Genus_ochro_unknown <- Genus[Genus$Division=="Ochrophyta",]
Genus_ochro_alpha_unknown <- data.frame(Genus_ochro_unknown[,11:283])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_ochro_known <- Genus_known[Genus_known$Division=="Ochrophyta",]
Genus_ochro_alpha_known <- data.frame(Genus_ochro_known[,11:283])

Genus_ochro_all <- subset(ASV_tax_N, Division=="Ochrophyta")
Genus_ochro_alpha_all <- data.frame(Genus_ochro_all[,11:283])

# Shannon diversity index 
ochro_div_moo_unknown <- data.frame(diversity(Genus_ochro_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",273)
ochro_moo_unknown <- cbind(ochro_div_moo_unknown,Group)
names(ochro_moo_unknown)[1]<-paste("Shannon")
shannon_moo_unknown <- rbind(shannon_moo_unknown,ochro_moo_unknown)

ochro_div_moo_known <- data.frame(diversity(Genus_ochro_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",273)
ochro_moo_known <- cbind(ochro_div_moo_known,Group)
names(ochro_moo_known)[1]<-paste("Shannon")
shannon_moo_known <- rbind(shannon_moo_known,ochro_moo_known)

ochro_div_moo_all <- data.frame(diversity(Genus_ochro_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",273)
ochro_moo_all <- cbind(ochro_div_moo_all,Group)
names(ochro_moo_all)[1]<-paste("Shannon")
shannon_moo_all <- rbind(shannon_moo_all,ochro_moo_all)

# Keep Cilio Division
Genus_cilio_unknown <- Genus[Genus$Division=="Ciliophora",]
Genus_cilio_alpha_unknown <- data.frame(Genus_cilio_unknown[,11:283])

Genus_cilio_known <- Genus_known[Genus_known$Division=="Ciliophora",]
Genus_cilio_alpha_known <- data.frame(Genus_cilio_known[,11:283])

Genus_cilio_all <- subset(ASV_tax_N, Division=="Ciliophora")
Genus_cilio_alpha_all <- data.frame(Genus_cilio_all[,11:283])

# Shannon diversity index 
cilio_div_moo_unknown <- data.frame(diversity(Genus_cilio_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",273)
cilio_moo_unknown <- cbind(cilio_div_moo_unknown,Group)
names(cilio_moo_unknown)[1]<-paste("Shannon")
shannon_moo_unknown <- rbind(shannon_moo_unknown,cilio_moo_unknown)

cilio_div_moo_known <- data.frame(diversity(Genus_cilio_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",273)
cilio_moo_known <- cbind(cilio_div_moo_known,Group)
names(cilio_moo_known)[1]<-paste("Shannon")
shannon_moo_known <- rbind(shannon_moo_known,cilio_moo_known)

cilio_div_moo_all <- data.frame(diversity(Genus_cilio_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",273)
cilio_moo_all <- cbind(cilio_div_moo_all,Group)
names(cilio_moo_all)[1]<-paste("Shannon")
shannon_moo_all <- rbind(shannon_moo_all,cilio_moo_all)

# Keep Rad Division
Genus_rad_unknown <- Genus[Genus$Division=="Radiolaria",]
Genus_rad_alpha_unknown <- data.frame(Genus_rad_unknown[,11:283])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_rad_known <- Genus_known[Genus_known$Division=="Radiolaria",]
Genus_rad_alpha_known <- data.frame(Genus_rad_known[,11:283])

Genus_rad_all <- subset(ASV_tax_N, Division=="Radiolaria")
Genus_rad_alpha_all <- data.frame(Genus_rad_all[,11:283])

# Shannon diversity index 
rad_div_moo_unknown <- data.frame(diversity(Genus_rad_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Radiolaria",273)
rad_moo_unknown <- cbind(rad_div_moo_unknown,Group)
names(rad_moo_unknown)[1]<-paste("Shannon")
shannon_moo_unknown <- rbind(shannon_moo_unknown,rad_moo_unknown)

rad_div_moo_known <- data.frame(diversity(Genus_rad_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Radiolaria",273)
rad_moo_known <- cbind(rad_div_moo_known,Group)
names(rad_moo_known)[1]<-paste("Shannon")
shannon_moo_known <- rbind(shannon_moo_known,rad_moo_known)

rad_div_moo_all <- data.frame(diversity(Genus_rad_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Radiolaria",273)
rad_moo_all <- cbind(rad_div_moo_all,Group)
names(rad_moo_all)[1]<-paste("Shannon")
shannon_moo_all <- rbind(shannon_moo_all,rad_moo_all)

# Keep Opalozoa Division
Genus_opa_unknown <- Genus[Genus$Division=="Opalozoa",]
Genus_opa_alpha_unknown <- data.frame(Genus_opa_unknown[,11:283])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_opa_known <- Genus_known[Genus_known$Division=="Opalozoa",]
Genus_opa_alpha_known <- data.frame(Genus_opa_known[,11:283])

Genus_opa_all <- subset(ASV_tax_N, Division=="Opalozoa")
Genus_opa_alpha_all <- data.frame(Genus_opa_all[,11:283])

# Shannon diversity index 
opa_div_moo_unknown <- data.frame(diversity(Genus_opa_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",273)
opa_moo_unknown <- cbind(opa_div_moo_unknown,Group)
names(opa_moo_unknown)[1]<-paste("Shannon")
shannon_moo_unknown <- rbind(shannon_moo_unknown,opa_moo_unknown)

opa_div_moo_known <- data.frame(diversity(Genus_opa_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",273)
opa_moo_known <- cbind(opa_div_moo_known,Group)
names(opa_moo_known)[1]<-paste("Shannon")
shannon_moo_known <- rbind(shannon_moo_known,opa_moo_known)

opa_div_moo_all <- data.frame(diversity(Genus_opa_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",273)
opa_moo_all <- cbind(opa_div_moo_all,Group)
names(opa_moo_all)[1]<-paste("Shannon")
shannon_moo_all <- rbind(shannon_moo_all,opa_moo_all)

Dataset <- rep("MOOSE",1365)
shannon_moo_unknown <- cbind(shannon_moo_unknown,Dataset)
shannon_moo_known <- cbind(shannon_moo_known,Dataset)
shannon_moo_all <- cbind(shannon_moo_all,Dataset)
###

##-- ASTAN --##
# Read ASV table
ASV_tax_N=read.csv("/shared/projects/formaldark/R_igraph/Final_files/ASV_ASTAN_final.csv",h=T, sep=",",row.names=1,stringsAsFactors = T)

# Subset table with unknown metabarcodes at genus level:
Genus <- subset(ASV_tax_N, Genus == "Unknown")
Genus <- droplevels(Genus)

# Get abundance of unknown metabarcodes  
abund<-0
division<-0
for (i in levels(Genus$Division)) {
  di <- Genus[Genus$Division == i, ]
  s_di <- colSums(di[,11:384])
  perc <- (s_di/colSums(Genus[,11:384]))*100
  m <- mean(perc,na.rm=T)
  abund <- c(abund,as.numeric(paste(m)))
  division <- c(division,i)
}

df_abund_as <- data.frame(abund,division)

#-#
# Quantification of Syndiales and Dinophyceae among Dinoflagellata
# Keep Dino Division
Dino <- ASV_tax_N[ASV_tax_N$Division=="Dinoflagellata",]
Dino <- droplevels(Dino)

#-#
# Quantification of Classes among Dinoflagellata
abund<-0
class<-0
for (i in levels(Dino$Class)) {
  cl <- Dino[Dino$Class == i, ]
  s_cl <- colSums(cl[,11:384])
  perc <- (s_cl/colSums(Dino[,11:384]))*100
  m <- mean(perc,na.rm=T)
  abund <- c(abund,as.numeric(paste(m)))
  class <- c(class,i)
}

dino_as <- data.frame(abund,class)

### Shannon α-div within Dinoflagellata, Ochrophyta, Cercozoa, Cryptophyta and Opalozoa
Genus_unknown <- subset(Dino, Genus == "Unknown")
Genus_dino_alpha_unknown <- data.frame(Genus_unknown[,11:384])

Genus_known <- subset(Dino, Genus != "Unknown")
Genus_dino_alpha_known <- data.frame(Genus_known[,11:384])

Genus_dino_alpha_all <- data.frame(Dino[,11:384])

# Quantification of known and unknowns among Syndiniales and Dinophyceae
S <- ASV_tax_N[ASV_tax_N$Class=="Syndiniales",]
DD <- ASV_tax_N[ASV_tax_N$Class=="Dinophyceae",]

K_S_ast <- S[S$Genus!="Unknown",]
K_S_ast <-  mean(data.frame((colSums(K_S_ast[,11:384])/colSums(S[,11:384]))*100)[,1])
UK_S_ast <- S[S$Genus=="Unknown",]
UK_S_ast <- mean(data.frame((colSums(UK_S_ast[,11:384])/colSums(S[,11:384]))*100)[,1])

K_DD_ast <- DD[DD$Genus!="Unknown",]
K_DD_ast <- mean(data.frame(((colSums(K_DD_ast[,11:384])/colSums(DD[,11:384]))*100))[,1])
UK_DD_ast <- DD[DD$Genus=="Unknown",]
UK_DD_ast <- mean(data.frame(((colSums(UK_DD_ast[,11:384])/colSums(DD[,11:384]))*100))[,1])
#-#

# Shannon diversity index 
dino_div_ast_unknown <- data.frame(diversity(Genus_dino_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",374)
shannon_ast_unknown <- cbind(dino_div_ast_unknown,Group)
names(shannon_ast_unknown)[1]<-paste("Shannon")

dino_div_ast_known <- data.frame(diversity(Genus_dino_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",374)
shannon_ast_known <- cbind(dino_div_ast_known,Group)
names(shannon_ast_known)[1]<-paste("Shannon")

dino_div_ast_all <- data.frame(diversity(Genus_dino_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",374)
shannon_ast_all <- cbind(dino_div_ast_all,Group)
names(shannon_ast_all)[1]<-paste("Shannon")

# Keep Ochro Division
Genus_ochro_unknown <- Genus[Genus$Division=="Ochrophyta",]
Genus_ochro_alpha_unknown <- data.frame(Genus_ochro_unknown[,11:384])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_ochro_known <- Genus_known[Genus_known$Division=="Ochrophyta",]
Genus_ochro_alpha_known <- data.frame(Genus_ochro_known[,11:384])

Genus_ochro_all <- subset(ASV_tax_N, Division=="Ochrophyta")
Genus_ochro_alpha_all <- data.frame(Genus_ochro_all[,11:384])

# Shannon diversity index 
ochro_div_ast_unknown <- data.frame(diversity(Genus_ochro_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",374)
ochro_ast_unknown <- cbind(ochro_div_ast_unknown,Group)
names(ochro_ast_unknown)[1]<-paste("Shannon")
shannon_ast_unknown <- rbind(shannon_ast_unknown,ochro_ast_unknown)

ochro_div_ast_known <- data.frame(diversity(Genus_ochro_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",374)
ochro_ast_known <- cbind(ochro_div_ast_known,Group)
names(ochro_ast_known)[1]<-paste("Shannon")
shannon_ast_known <- rbind(shannon_ast_known,ochro_ast_known)

ochro_div_ast_all <- data.frame(diversity(Genus_ochro_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",374)
ochro_ast_all <- cbind(ochro_div_ast_all,Group)
names(ochro_ast_all)[1]<-paste("Shannon")
shannon_ast_all <- rbind(shannon_ast_all,ochro_ast_all)

# Keep Cercozoa Division
Genus_cerco_unknown <- Genus[Genus$Division=="Cercozoa",]
Genus_cerco_alpha_unknown <- data.frame(Genus_cerco_unknown[,11:384])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_cerco_known <- Genus_known[Genus_known$Division=="Cercozoa",]
Genus_cerco_alpha_known <- data.frame(Genus_cerco_known[,11:384])

Genus_cerco_all <- subset(ASV_tax_N, Division=="Cercozoa")
Genus_cerco_alpha_all <- data.frame(Genus_cerco_all[,11:384])

# Shannon diversity index 
cerco_div_ast_unknown <- data.frame(diversity(Genus_cerco_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Cercozoa",374)
cerco_ast_unknown <- cbind(cerco_div_ast_unknown,Group)
names(cerco_ast_unknown)[1]<-paste("Shannon")
shannon_ast_unknown <- rbind(shannon_ast_unknown,cerco_ast_unknown)

cerco_div_ast_known <- data.frame(diversity(Genus_cerco_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Cercozoa",374)
cerco_ast_known <- cbind(cerco_div_ast_known,Group)
names(cerco_ast_known)[1]<-paste("Shannon")
shannon_ast_known <- rbind(shannon_ast_known,cerco_ast_known)

cerco_div_ast_all <- data.frame(diversity(Genus_cerco_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Cercozoa",374)
cerco_ast_all <- cbind(cerco_div_ast_all,Group)
names(cerco_ast_all)[1]<-paste("Shannon")
shannon_ast_all <- rbind(shannon_ast_all,cerco_ast_all)

# Keep Cryptophyta Division
Genus_crypt_unknown <- Genus[Genus$Division=="Cryptophyta",]
Genus_crypt_alpha_unknown <- data.frame(Genus_crypt_unknown[,11:384])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_crypt_known <- Genus_known[Genus_known$Division=="Cryptophyta",]
Genus_crypt_alpha_known <- data.frame(Genus_crypt_known[,11:384])

Genus_crypt_all <- subset(ASV_tax_N, Division=="Cryptophyta")
Genus_crypt_alpha_all <- data.frame(Genus_crypt_all[,11:384])

# Shannon diversity index 
crypt_div_ast_unknown <- data.frame(diversity(Genus_crypt_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Cryptophyta",374)
crypt_ast_unknown <- cbind(crypt_div_ast_unknown,Group)
names(crypt_ast_unknown)[1]<-paste("Shannon")
shannon_ast_unknown <- rbind(shannon_ast_unknown,crypt_ast_unknown)

crypt_div_ast_known <- data.frame(diversity(Genus_crypt_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Cryptophyta",374)
crypt_ast_known <- cbind(crypt_div_ast_known,Group)
names(crypt_ast_known)[1]<-paste("Shannon")
shannon_ast_known <- rbind(shannon_ast_known,crypt_ast_known)

crypt_div_ast_all <- data.frame(diversity(Genus_crypt_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Cryptophyta",374)
crypt_ast_all <- cbind(crypt_div_ast_all,Group)
names(crypt_ast_all)[1]<-paste("Shannon")
shannon_ast_all <- rbind(shannon_ast_all,crypt_ast_all)

# Keep Opalozoa Division
Genus_opa_unknown <- Genus[Genus$Division=="Opalozoa",]
Genus_opa_alpha_unknown <- data.frame(Genus_opa_unknown[,11:384])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_opa_known <- Genus_known[Genus_known$Division=="Opalozoa",]
Genus_opa_alpha_known <- data.frame(Genus_opa_known[,11:384])

Genus_opa_all <- subset(ASV_tax_N, Division=="Opalozoa")
Genus_opa_alpha_all <- data.frame(Genus_opa_all[,11:384])

# Shannon diversity index 
opa_div_ast_unknown <- data.frame(diversity(Genus_opa_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",374)
opa_ast_unknown <- cbind(opa_div_ast_unknown,Group)
names(opa_ast_unknown)[1]<-paste("Shannon")
shannon_ast_unknown <- rbind(shannon_ast_unknown,opa_ast_unknown)

opa_div_ast_known <- data.frame(diversity(Genus_opa_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",374)
opa_ast_known <- cbind(opa_div_ast_known,Group)
names(opa_ast_known)[1]<-paste("Shannon")
shannon_ast_known <- rbind(shannon_ast_known,opa_ast_known)

opa_div_ast_all <- data.frame(diversity(Genus_opa_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",374)
opa_ast_all <- cbind(opa_div_ast_all,Group)
names(opa_ast_all)[1]<-paste("Shannon")
shannon_ast_all <- rbind(shannon_ast_all,opa_ast_all)

Dataset <- rep("ASTAN",1870)
shannon_ast_unknown <- cbind(shannon_ast_unknown,Dataset)
shannon_ast_known <- cbind(shannon_ast_known,Dataset)
shannon_ast_all <- cbind(shannon_ast_all,Dataset)
###

##-- SOLA --##
# Read ASV table
ASV_tax_N=read.csv("/shared/projects/formaldark/R_igraph/Final_files/ASV_SOLA_final.csv",h=T, sep=",",row.names=1,stringsAsFactors = T)

# Subset table with unknown metabarcodes at genus level:
Genus <- subset(ASV_tax_N, Genus == "Unknown")
Genus <- droplevels(Genus)

# Get abundance of unknown metabarcodes  
abund<-0
division<-0
for (i in levels(Genus$Division)) {
  di <- Genus[Genus$Division == i, ]
  s_di <- colSums(di[,11:168])
  perc <- (s_di/colSums(Genus[,11:168]))*100
  m <- mean(perc,na.rm=T)
  abund <- c(abund,as.numeric(paste(m)))
  division <- c(division,i)
}

df_abund_so <- data.frame(abund,division)

#-#
# Quantification of Syndiales and Dinophyceae among Dinoflagellata
# Keep Dino Division
Dino <- ASV_tax_N[ASV_tax_N$Division=="Dinoflagellata",]
Dino <- droplevels(Dino)

#-#
# Quantification of Classes among Dinoflagellata
abund<-0
class<-0
for (i in levels(Dino$Class)) {
  cl <- Dino[Dino$Class == i, ]
  s_cl <- colSums(cl[,11:168])
  perc <- (s_cl/colSums(Dino[,11:168]))*100
  m <- mean(perc,na.rm=T)
  abund <- c(abund,as.numeric(paste(m)))
  class <- c(class,i)
}

dino_so <- data.frame(abund,class)

### Shannon α-div within Dinoflagellata, Ochrophyta, Ciliophora, Cercozoa and Opalozoa
Genus_unknown <- subset(Dino, Genus == "Unknown")
Genus_dino_alpha_unknown <- data.frame(Genus_unknown[,11:168])

Genus_known <- subset(Dino, Genus != "Unknown")
Genus_dino_alpha_known <- data.frame(Genus_known[,11:168])

Genus_dino_alpha_all <- data.frame(Dino[,11:168])

# Quantification of known and unknowns among Syndiniales and Dinophyceae
S <- ASV_tax_N[ASV_tax_N$Class=="Syndiniales",]
DD <- ASV_tax_N[ASV_tax_N$Class=="Dinophyceae",]

K_S_sol <- S[S$Genus!="Unknown",]
K_S_sol <-  mean(na.omit(data.frame((colSums(K_S_sol[,11:168])/colSums(S[,11:168]))*100)[,1]))
UK_S_sol <- S[S$Genus=="Unknown",]
UK_S_sol <- mean(na.omit(data.frame((colSums(UK_S_sol[,11:168])/colSums(S[,11:168]))*100)[,1]))

K_DD_sol <- DD[DD$Genus!="Unknown",]
K_DD_sol <- mean(na.omit(data.frame(((colSums(K_DD_sol[,11:168])/colSums(DD[,11:168]))*100))[,1]))
UK_DD_sol <- DD[DD$Genus=="Unknown",]
UK_DD_sol <- mean(na.omit(data.frame(((colSums(UK_DD_sol[,11:168])/colSums(DD[,11:168]))*100))[,1]))
#-#

# Shannon diversity index 
dino_div_sol_unknown <- data.frame(diversity(Genus_dino_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",158)
shannon_sol_unknown <- cbind(dino_div_sol_unknown,Group)
names(shannon_sol_unknown)[1]<-paste("Shannon")

dino_div_sol_known <- data.frame(diversity(Genus_dino_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",158)
shannon_sol_known <- cbind(dino_div_sol_known,Group)
names(shannon_sol_known)[1]<-paste("Shannon")

dino_div_sol_all <- data.frame(diversity(Genus_dino_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",158)
shannon_sol_all <- cbind(dino_div_sol_all,Group)
names(shannon_sol_all)[1]<-paste("Shannon")

# Keep Ochro Division
Genus_ochro_unknown <- Genus[Genus$Division=="Ochrophyta",]
Genus_ochro_alpha_unknown <- data.frame(Genus_ochro_unknown[,11:168])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_ochro_known <- Genus_known[Genus_known$Division=="Ochrophyta",]
Genus_ochro_alpha_known <- data.frame(Genus_ochro_known[,11:168])

Genus_ochro_all <- subset(ASV_tax_N, Division=="Ochrophyta")
Genus_ochro_alpha_all <- data.frame(Genus_ochro_all[,11:168])

# Shannon diversity index 
ochro_div_sol_unknown <- data.frame(diversity(Genus_ochro_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",158)
ochro_sol_unknown <- cbind(ochro_div_sol_unknown,Group)
names(ochro_sol_unknown)[1]<-paste("Shannon")
shannon_sol_unknown <- rbind(shannon_sol_unknown,ochro_sol_unknown)

ochro_div_sol_known <- data.frame(diversity(Genus_ochro_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",158)
ochro_sol_known <- cbind(ochro_div_sol_known,Group)
names(ochro_sol_known)[1]<-paste("Shannon")
shannon_sol_known <- rbind(shannon_sol_known,ochro_sol_known)

ochro_div_sol_all <- data.frame(diversity(Genus_ochro_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",158)
ochro_sol_all <- cbind(ochro_div_sol_all,Group)
names(ochro_sol_all)[1]<-paste("Shannon")
shannon_sol_all <- rbind(shannon_sol_all,ochro_sol_all)

# Keep Cercozoa Division
Genus_cerco_unknown <- Genus[Genus$Division=="Cercozoa",]
Genus_cerco_alpha_unknown <- data.frame(Genus_cerco_unknown[,11:168])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_cerco_known <- Genus_known[Genus_known$Division=="Cercozoa",]
Genus_cerco_alpha_known <- data.frame(Genus_cerco_known[,11:168])

Genus_cerco_all <- subset(ASV_tax_N, Division=="Cercozoa")
Genus_cerco_alpha_all <- data.frame(Genus_cerco_all[,11:168])

# Shannon diversity index 
cerco_div_sol_unknown <- data.frame(diversity(Genus_cerco_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Cercozoa",158)
cerco_sol_unknown <- cbind(cerco_div_sol_unknown,Group)
names(cerco_sol_unknown)[1]<-paste("Shannon")
shannon_sol_unknown <- rbind(shannon_sol_unknown,cerco_sol_unknown)

cerco_div_sol_known <- data.frame(diversity(Genus_cerco_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Cercozoa",158)
cerco_sol_known <- cbind(cerco_div_sol_known,Group)
names(cerco_sol_known)[1]<-paste("Shannon")
shannon_sol_known <- rbind(shannon_sol_known,cerco_sol_known)

cerco_div_sol_all <- data.frame(diversity(Genus_cerco_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Cercozoa",158)
cerco_sol_all <- cbind(cerco_div_sol_all,Group)
names(cerco_sol_all)[1]<-paste("Shannon")
shannon_sol_all <- rbind(shannon_sol_all,cerco_sol_all)

# Keep Ciliophora Division
Genus_cilio_unknown <- Genus[Genus$Division=="Ciliophora",]
Genus_cilio_alpha_unknown <- data.frame(Genus_cilio_unknown[,11:168])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_cilio_known <- Genus_known[Genus_known$Division=="Ciliophora",]
Genus_cilio_alpha_known <- data.frame(Genus_cilio_known[,11:168])

Genus_cilio_all <- subset(ASV_tax_N, Division=="Ciliophora")
Genus_cilio_alpha_all <- data.frame(Genus_cilio_all[,11:168])

# Shannon diversity index 
cilio_div_sol_unknown <- data.frame(diversity(Genus_cilio_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",158)
cilio_sol_unknown <- cbind(cilio_div_sol_unknown,Group)
names(cilio_sol_unknown)[1]<-paste("Shannon")
shannon_sol_unknown <- rbind(shannon_sol_unknown,cilio_sol_unknown)

cilio_div_sol_known <- data.frame(diversity(Genus_cilio_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",158)
cilio_sol_known <- cbind(cilio_div_sol_known,Group)
names(cilio_sol_known)[1]<-paste("Shannon")
shannon_sol_known <- rbind(shannon_sol_known,cilio_sol_known)

cilio_div_sol_all <- data.frame(diversity(Genus_cilio_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Ciliophora",158)
cilio_sol_all <- cbind(cilio_div_sol_all,Group)
names(cilio_sol_all)[1]<-paste("Shannon")
shannon_sol_all <- rbind(shannon_sol_all,cilio_sol_all)

# Keep Opalozoa Division
Genus_opa_unknown <- Genus[Genus$Division=="Opalozoa",]
Genus_opa_alpha_unknown <- data.frame(Genus_opa_unknown[,11:168])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_opa_known <- Genus_known[Genus_known$Division=="Opalozoa",]
Genus_opa_alpha_known <- data.frame(Genus_opa_known[,11:168])

Genus_opa_all <- subset(ASV_tax_N, Division=="Opalozoa")
Genus_opa_alpha_all <- data.frame(Genus_opa_all[,11:168])

# Shannon diversity index 
opa_div_sol_unknown <- data.frame(diversity(Genus_opa_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",158)
opa_sol_unknown <- cbind(opa_div_sol_unknown,Group)
names(opa_sol_unknown)[1]<-paste("Shannon")
shannon_sol_unknown <- rbind(shannon_sol_unknown,opa_sol_unknown)

opa_div_sol_known <- data.frame(diversity(Genus_opa_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",158)
opa_sol_known <- cbind(opa_div_sol_known,Group)
names(opa_sol_known)[1]<-paste("Shannon")
shannon_sol_known <- rbind(shannon_sol_known,opa_sol_known)

opa_div_sol_all <- data.frame(diversity(Genus_opa_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",158)
opa_sol_all <- cbind(opa_div_sol_all,Group)
names(opa_sol_all)[1]<-paste("Shannon")
shannon_sol_all <- rbind(shannon_sol_all,opa_sol_all)

Dataset <- rep("SOLA",790)
shannon_sol_unknown <- cbind(shannon_sol_unknown,Dataset)
shannon_sol_known <- cbind(shannon_sol_known,Dataset)
shannon_sol_all <- cbind(shannon_sol_all,Dataset)
###


##-- BBMO --##
# Read ASV table
ASV_tax_N=read.csv("/shared/projects/formaldark/R_igraph/Final_files/ASV_BBMO_final.csv",h=T, sep=",",row.names=1,stringsAsFactors = T)

# Subset table with unknown metabarcodes at genus level:
Genus <- subset(ASV_tax_N, Genus == "Unknown")
Genus <- droplevels(Genus)

# Get abundance of unknown metabarcodes  
abund<-0
division<-0
for (i in levels(Genus$Division)) {
  di <- Genus[Genus$Division == i, ]
  s_di <- colSums(di[,11:337])
  perc <- (s_di/colSums(Genus[,11:337]))*100
  m <- mean(perc,na.rm=T)
  abund <- c(abund,as.numeric(paste(m)))
  division <- c(division,i)
}

df_abund_bb <- data.frame(abund,division)

#-#
# Quantification of Syndiales and Dinophyceae among Dinoflagellata
# Keep Dino Division
Dino <- ASV_tax_N[ASV_tax_N$Division=="Dinoflagellata",]
Dino <- droplevels(Dino)

#-#
# Quantification of Classes among Dinoflagellata
abund<-0
class<-0
for (i in levels(Dino$Class)) {
  cl <- Dino[Dino$Class == i, ]
  s_cl <- colSums(cl[,11:337])
  perc <- (s_cl/colSums(Dino[,11:337]))*100
  m <- mean(perc,na.rm=T)
  abund <- c(abund,as.numeric(paste(m)))
  class <- c(class,i)
}

dino_bb <- data.frame(abund,class)

### Shannon α-div within Dinoflagellata, Ochrophyta, Cryptophyta, Opalozoa and Sagenista
Genus_unknown <- subset(Dino, Genus == "Unknown")
Genus_dino_alpha_unknown <- data.frame(Genus_unknown[,11:337])

Genus_known <- subset(Dino, Genus != "Unknown")
Genus_dino_alpha_known <- data.frame(Genus_known[,11:337])

Genus_dino_alpha_all <- data.frame(Dino[,11:337])

# Quantification of known and unknowns among Syndiniales and Dinophyceae
S <- ASV_tax_N[ASV_tax_N$Class=="Syndiniales",]
DD <- ASV_tax_N[ASV_tax_N$Class=="Dinophyceae",]

K_S_bbmo <- S[S$Genus!="Unknown",]
K_S_bbmo <-  mean(na.omit(data.frame((colSums(K_S_bbmo[,11:337])/colSums(S[,11:337]))*100)[,1]))
UK_S_bbmo <- S[S$Genus=="Unknown",]
UK_S_bbmo <- mean(na.omit(data.frame((colSums(UK_S_bbmo[,11:337])/colSums(S[,11:337]))*100)[,1]))

K_DD_bbmo <- DD[DD$Genus!="Unknown",]
K_DD_bbmo <- mean(na.omit(data.frame(((colSums(K_DD_bbmo[,11:337])/colSums(DD[,11:337]))*100))[,1]))
UK_DD_bbmo <- DD[DD$Genus=="Unknown",]
UK_DD_bbmo <- mean(na.omit(data.frame(((colSums(UK_DD_bbmo[,11:337])/colSums(DD[,11:337]))*100))[,1]))
#-#

# Shannon diversity index 
dino_div_bbmo_unknown <- data.frame(diversity(Genus_dino_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",327)
shannon_bbmo_unknown <- cbind(dino_div_bbmo_unknown,Group)
names(shannon_bbmo_unknown)[1]<-paste("Shannon")

dino_div_bbmo_known <- data.frame(diversity(Genus_dino_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",327)
shannon_bbmo_known <- cbind(dino_div_bbmo_known,Group)
names(shannon_bbmo_known)[1]<-paste("Shannon")

dino_div_bbmo_all <- data.frame(diversity(Genus_dino_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Dinoflagellata",327)
shannon_bbmo_all <- cbind(dino_div_bbmo_all,Group)
names(shannon_bbmo_all)[1]<-paste("Shannon")

# Keep Ochro Division
Genus_ochro_unknown <- Genus[Genus$Division=="Ochrophyta",]
Genus_ochro_alpha_unknown <- data.frame(Genus_ochro_unknown[,11:337])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_ochro_known <- Genus_known[Genus_known$Division=="Ochrophyta",]
Genus_ochro_alpha_known <- data.frame(Genus_ochro_known[,11:337])

Genus_ochro_all <- subset(ASV_tax_N, Division=="Ochrophyta")
Genus_ochro_alpha_all <- data.frame(Genus_ochro_all[,11:337])

# Shannon diversity index 
ochro_div_bbmo_unknown <- data.frame(diversity(Genus_ochro_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",327)
ochro_bbmo_unknown <- cbind(ochro_div_bbmo_unknown,Group)
names(ochro_bbmo_unknown)[1]<-paste("Shannon")
shannon_bbmo_unknown <- rbind(shannon_bbmo_unknown,ochro_bbmo_unknown)

ochro_div_bbmo_known <- data.frame(diversity(Genus_ochro_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",327)
ochro_bbmo_known <- cbind(ochro_div_bbmo_known,Group)
names(ochro_bbmo_known)[1]<-paste("Shannon")
shannon_bbmo_known <- rbind(shannon_bbmo_known,ochro_bbmo_known)

ochro_div_bbmo_all <- data.frame(diversity(Genus_ochro_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Ochrophyta",327)
ochro_bbmo_all <- cbind(ochro_div_bbmo_all,Group)
names(ochro_bbmo_all)[1]<-paste("Shannon")
shannon_bbmo_all <- rbind(shannon_bbmo_all,ochro_bbmo_all)

# Keep Opalozoa Division
Genus_opa_unknown <- Genus[Genus$Division=="Opalozoa",]
Genus_opa_alpha_unknown <- data.frame(Genus_opa_unknown[,11:337])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_opa_known <- Genus_known[Genus_known$Division=="Opalozoa",]
Genus_opa_alpha_known <- data.frame(Genus_opa_known[,11:337])

Genus_opa_all <- subset(ASV_tax_N, Division=="Opalozoa")
Genus_opa_alpha_all <- data.frame(Genus_opa_all[,11:337])

# Shannon diversity index 
opa_div_bbmo_unknown <- data.frame(diversity(Genus_opa_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",327)
opa_bbmo_unknown <- cbind(opa_div_bbmo_unknown,Group)
names(opa_bbmo_unknown)[1]<-paste("Shannon")
shannon_bbmo_unknown <- rbind(shannon_bbmo_unknown,opa_bbmo_unknown)

opa_div_bbmo_known <- data.frame(diversity(Genus_opa_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",327)
opa_bbmo_known <- cbind(opa_div_bbmo_known,Group)
names(opa_bbmo_known)[1]<-paste("Shannon")
shannon_bbmo_known <- rbind(shannon_bbmo_known,opa_bbmo_known)

opa_div_bbmo_all <- data.frame(diversity(Genus_opa_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Opalozoa",327)
opa_bbmo_all <- cbind(opa_div_bbmo_all,Group)
names(opa_bbmo_all)[1]<-paste("Shannon")
shannon_bbmo_all <- rbind(shannon_bbmo_all,opa_bbmo_all)

# Keep Sagenista Division
Genus_sag_unknown <- Genus[Genus$Division=="Sagenista",]
Genus_sag_alpha_unknown <- data.frame(Genus_sag_unknown[,11:337])

Genus_known <- subset(ASV_tax_N, Genus != "Unknown")
Genus_sag_known <- Genus_known[Genus_known$Division=="Sagenista",]
Genus_sag_alpha_known <- data.frame(Genus_sag_known[,11:337])

Genus_sag_all <- subset(ASV_tax_N, Division=="Sagenista")
Genus_sag_alpha_all <- data.frame(Genus_sag_all[,11:337])

# Shannon diversity index 
sag_div_bbmo_unknown <- data.frame(diversity(Genus_sag_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Sagenista",327)
sag_bbmo_unknown <- cbind(sag_div_bbmo_unknown,Group)
names(sag_bbmo_unknown)[1]<-paste("Shannon")
shannon_bbmo_unknown <- rbind(shannon_bbmo_unknown,sag_bbmo_unknown)

sag_div_bbmo_known <- data.frame(diversity(Genus_sag_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Sagenista",327)
sag_bbmo_known <- cbind(sag_div_bbmo_known,Group)
names(sag_bbmo_known)[1]<-paste("Shannon")
shannon_bbmo_known <- rbind(shannon_bbmo_known,sag_bbmo_known)

sag_div_bbmo_all <- data.frame(diversity(Genus_sag_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Sagenista",327)
sag_bbmo_all <- cbind(sag_div_bbmo_all,Group)
names(sag_bbmo_all)[1]<-paste("Shannon")
shannon_bbmo_all <- rbind(shannon_bbmo_all,sag_bbmo_all)

# Keep Cryptophyta Division
Genus_crypt_unknown <- Genus[Genus$Division=="Cryptophyta",]
Genus_crypt_alpha_unknown <- data.frame(Genus_crypt_unknown[,11:337])

Genus_crypt_known <- Genus_known[Genus_known$Division=="Cryptophyta",]
Genus_crypt_alpha_known <- data.frame(Genus_crypt_known[,11:337])

Genus_crypt_all <- subset(ASV_tax_N, Division=="Cryptophyta")
Genus_crypt_alpha_all <- data.frame(Genus_crypt_all[,11:337])

# Shannon diversity index 
crypt_div_bbmo_unknown <- data.frame(diversity(Genus_crypt_alpha_unknown, index = "shannon",MARGIN=2))
Group <- rep("Cryptophyta",327)
crypt_bbmo_unknown <- cbind(crypt_div_bbmo_unknown,Group)
names(crypt_bbmo_unknown)[1]<-paste("Shannon")
shannon_bbmo_unknown <- rbind(shannon_bbmo_unknown,crypt_bbmo_unknown)

crypt_div_bbmo_known <- data.frame(diversity(Genus_crypt_alpha_known, index = "shannon",MARGIN=2))
Group <- rep("Cryptophyta",327)
crypt_bbmo_known <- cbind(crypt_div_bbmo_known,Group)
names(crypt_bbmo_known)[1]<-paste("Shannon")
shannon_bbmo_known <- rbind(shannon_bbmo_known,crypt_bbmo_known)

crypt_div_bbmo_all <- data.frame(diversity(Genus_crypt_alpha_all, index = "shannon",MARGIN=2))
Group <- rep("Cryptophyta",327)
crypt_bbmo_all <- cbind(crypt_div_bbmo_all,Group)
names(crypt_bbmo_all)[1]<-paste("Shannon")
shannon_bbmo_all <- rbind(shannon_bbmo_all,crypt_bbmo_all)

Dataset <- rep("BBMO",1635)
shannon_bbmo_unknown <- cbind(shannon_bbmo_unknown,Dataset)
shannon_bbmo_known <- cbind(shannon_bbmo_known,Dataset)
shannon_bbmo_all <- cbind(shannon_bbmo_all,Dataset)
###
```

Figure S4(A, bottom)

```{r}
# Read data
don=read.csv("/shared/projects/formaldark/R_igraph/Final_files/Fig_S4A_division_abund_diversity.csv",h=T, sep=";",stringsAsFactors = TRUE)

# Order columns in data frame
don$Dataset <- factor(don$Dataset,levels = c("BioMarKs","ASTAN","BBMO","SOLA", "Malaspina","MOOSE"))
don$Division <- factor(don$Division,levels = c("Dinoflagellata","Ochrophyta","Ciliophora","Radiolaria",
                                               "Cercozoa","Cryptophyta","Opalozoa","Sagenista","Other"))

p6<-ggplot(don, aes(fill=Division, y=Unknowns_abund, x=Dataset)) + 
  geom_bar(position="fill", stat="identity", colour="black") +
  theme_linedraw() +
  facet_grid(~Dataset, scales = "free_x") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_manual(values = c("navy", "darkorange4","darkred","magenta4","darkolivegreen1","orangered",
                               "steelblue1", "tan1" ,"black")) +
  ylab("Abundance of unassigned metabarcodes (%)") 

plot(p6)
```

# A-diversity

Figure S4 B

```{r}
## All
don <- rbind(shannon_ast_all,shannon_bbmo_all,shannon_biomarks_all,shannon_mal_all,shannon_moo_all,shannon_sol_all)
don <- don[complete.cases(don), ]

# Order columns in data frame
don$Dataset <- factor(don$Dataset,levels = c("BioMarKs","ASTAN","BBMO","SOLA", "Malaspina","MOOSE"))
don$Group <- factor(don$Group,levels = c("Dinoflagellata","Ochrophyta","Ciliophora","Radiolaria",
                                         "Cercozoa","Cryptophyta","Opalozoa","Sagenista"))

p10<-ggplot(don, aes(x=Dataset, y=Shannon, fill=Group)) +
  geom_boxplot(outlier.colour="black", outlier.shape=1,
               outlier.size=1) +
  theme_linedraw() +
  facet_grid(~Dataset, scales = "free_x") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_manual(values = c("navy", "darkorange4","darkred","magenta4","darkolivegreen1","orangered",
                               "steelblue1", "tan1" ,"black")) +
  labs(fill="Division") +
  ylab("Shannon diversity index") +
  ggtitle("Assigned and unassigned metabarcodes at genus level") +
  theme(plot.title = element_text(hjust=0.5, face="bold"))

## Known
don <- rbind(shannon_ast_known,shannon_bbmo_known,shannon_biomarks_known,shannon_mal_known,shannon_moo_known,shannon_sol_known)
# Remove NA's linked to some samples with 0 abund
don <- don[complete.cases(don), ]

# Order columns in data frame
don$Dataset <- factor(don$Dataset,levels = c("BioMarKs","ASTAN","BBMO","SOLA", "Malaspina","MOOSE"))
don$Group <- factor(don$Group,levels = c("Dinoflagellata","Ochrophyta","Ciliophora","Radiolaria",
                                         "Cercozoa","Cryptophyta","Opalozoa","Sagenista"))

p11<-ggplot(don, aes(x=Dataset, y=Shannon, fill=Group)) +
  geom_boxplot(outlier.colour="black", outlier.shape=1,
               outlier.size=1) +
  theme_linedraw() +
  facet_grid(~Dataset, scales = "free_x") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_manual(values = c("navy", "darkorange4","darkred","magenta4","darkolivegreen1","orangered",
                               "steelblue1", "tan1" ,"black")) +
  labs(fill="Division") +
  ylab("Shannon diversity index") +
  ggtitle("Assigned metabarcodes at genus level") +
  theme(plot.title = element_text(hjust=0.5, face="bold"))

## Unknown
don <- rbind(shannon_ast_unknown,shannon_bbmo_unknown,shannon_biomarks_unknown,shannon_mal_unknown,shannon_moo_unknown,shannon_sol_unknown)
don <- don[complete.cases(don), ]

# Order columns in data frame
don$Dataset <- factor(don$Dataset,levels = c("BioMarKs","ASTAN","BBMO","SOLA", "Malaspina","MOOSE"))
don$Group <- factor(don$Group,levels = c("Dinoflagellata","Ochrophyta","Ciliophora","Radiolaria",
                                         "Cercozoa","Cryptophyta","Opalozoa","Sagenista"))

p7<-ggplot(don, aes(x=Dataset, y=Shannon, fill=Group)) +
  geom_boxplot(outlier.colour="black", outlier.shape=1,
               outlier.size=1) +
  theme_linedraw() +
  facet_grid(~Dataset, scales = "free_x") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_manual(values = c("navy", "darkorange4","darkred","magenta4","darkolivegreen1","orangered",
                               "steelblue1", "tan1" ,"black")) +
  labs(fill="Division") +
  ylab("Shannon diversity index") +
  ggtitle("Unassigned metabarcodes at genus level") +
  theme(plot.title = element_text(hjust=0.5, face="bold"))

grid.arrange(nrow=3,p10,p11,p7)
```

## 5. Dinoflagellata classes: representativity of each class and unassigned sequences among them 

Figure S5 (A)

```{r}
# Proportion of Syndiniales and Dinophyceae 
# Read data
don=read.csv("/shared/projects/formaldark/R_igraph/Final_files/Fig_S5A_Dinoflag_Synd_Dinoph.csv",h=T, sep=";",stringsAsFactors = TRUE)

# Order columns in data frame
don$Dataset <- factor(don$Dataset,levels = c("BioMarKs","ASTAN","BBMO","SOLA", "Malaspina","MOOSE"))
don$Class <- factor(don$Class,levels = c("Dinophyceae","Syndiniales","Others"))

## Diversity
p8 <- ggplot(don, aes(x=Dataset, y=Diversity, fill=Class)) +
  geom_bar(position="fill", stat="identity", colour="black") +
  theme_linedraw() +
  facet_grid(~Dataset, scales = "free_x") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_manual(values = c("forestgreen","purple","black")) +
      labs(fill="Dinoflagellata Class") +
  ylab("Number of Dinoflagellata metabarcodes (%)")

## Abundance
p9 <- ggplot(don, aes(x=Dataset, y=Abundance, fill=Class)) +
  geom_bar(position="fill", stat="identity", colour="black") +
  theme_linedraw() +
  facet_grid(~Dataset, scales = "free_x") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_manual(values = c("forestgreen","purple","black")) +
    labs(fill="Dinoflagellata Class") +
  ylab("Abundance of Dinoflagellata metabarcodes (%)")

grid.arrange(nrow=2,p8,p9)
```

Figure 1(C)
Figure S5 (B)

```{r}
## Diversity
# Create data frame
Perc <- c(Biom_dinop_k,Biom_dinop_uk,Ast_dinop_k,Ast_dinop_uk,BBMO_dinop_k,BBMO_dinop_uk,Sol_dinop_k,Sol_dinop_uk,Mal_dinop_k,Mal_dinop_uk,Moo_dinop_k,Moo_dinop_uk,
          Biom_synd_k,Biom_synd_uk,Ast_synd_k,Ast_synd_uk,BBMO_synd_k,BBMO_synd_uk,Sol_synd_k,Sol_synd_uk,Mal_synd_k,Mal_synd_uk,Moo_synd_k,Moo_synd_uk)
Genus_status <- rep(c("Assigned","Unassigned"),12)
Dataset <- rep(c(rep(c("BioMarKs"),2), rep(c("ASTAN"),2),rep(c("BBMO"),2),rep(c("SOLA"),2),rep(c("Malaspina"),2),rep(c("MOOSE"),2)),2)
Class <- c(rep("Dinophyceae",12),rep("Syndiniales",12))

don <- data.frame(Dataset,Class,Genus_status,Perc)
don$Dataset <- factor(don$Dataset,levels = c("BioMarKs","ASTAN","BBMO","SOLA", "Malaspina","MOOSE"))
don$Genus_status <- factor(don$Genus_status,levels = c("Assigned","Unassigned"))

# Dinophyceae
dinop <- don[don$Class=="Dinophyceae",]

p10 <- ggplot(dinop, aes(x=Dataset, y=Perc, fill=Genus_status)) +
  geom_bar(position="fill", stat="identity", colour="black") +
  theme_linedraw() +
  facet_grid(~Dataset, scales = "free_x") +
  labs(fill="Genus taxonomic status") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_manual(values = c("firebrick","black")) +
  ylab("Number of Dinophyceae metabarcodes (%)")

# Syndiniales
synd <- don[don$Class=="Syndiniales",]

p11 <- ggplot(synd, aes(x=Dataset, y=Perc, fill=Genus_status)) +
  geom_bar(position="fill", stat="identity", colour="black") +
  theme_linedraw() +
  facet_grid(~Dataset, scales = "free_x") +
  labs(fill="Genus taxonomic status") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_manual(values = c("firebrick","black")) +
  ylab("Number of Syndiniales metabarcodes (%)")

## Abundance
# Create data frame
Perc <- c(K_DD_biom,UK_DD_biom,K_DD_ast,UK_DD_ast,K_DD_bbmo,UK_DD_bbmo,K_DD_sol,UK_DD_sol,K_DD_mal,UK_DD_mal,K_DD_moo,UK_DD_moo,
          K_S_biom,UK_S_biom,K_S_ast,UK_S_ast,K_S_bbmo,UK_S_bbmo,K_S_sol,UK_S_sol,K_S_mal,UK_S_mal,K_S_moo,UK_S_moo)
Genus_status <- rep(c("Assigned","Unassigned"),12)
Dataset <- rep(c(rep(c("BioMarKs"),2), rep(c("ASTAN"),2),rep(c("BBMO"),2),rep(c("SOLA"),2),rep(c("Malaspina"),2),rep(c("MOOSE"),2)),2)
Class <- c(rep("Dinophyceae",12),rep("Syndiniales",12))

don <- data.frame(Dataset,Class,Genus_status,Perc)
don$Dataset <- factor(don$Dataset,levels = c("BioMarKs","ASTAN","BBMO","SOLA", "Malaspina","MOOSE"))
don$Genus_status <- factor(don$Genus_status,levels = c("Assigned","Unassigned"))

# Dinophyceae
dinop <- don[don$Class=="Dinophyceae",]

p12 <- ggplot(dinop, aes(x=Dataset, y=Perc, fill=Genus_status)) +
  geom_bar(position="fill", stat="identity", colour="black") +
  theme_linedraw() +
  facet_grid(~Dataset, scales = "free_x") +
  labs(fill="Genus taxonomic status") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_manual(values = c("firebrick","black")) +
  ylab("Abundance of Dinophyceae metabarcodes (%)")

# Syndiniales
synd <- don[don$Class=="Syndiniales",]

p13 <- ggplot(synd, aes(x=Dataset, y=Perc, fill=Genus_status)) +
  geom_bar(position="fill", stat="identity", colour="black") +
  theme_linedraw() +
  facet_grid(~Dataset, scales = "free_x") +
  labs(fill="Genus taxonomic status") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), axis.ticks.x=element_blank(),
        strip.text.x = element_text(color = "white", face = "bold"),
        legend.title = element_text(face="bold")) +
  scale_fill_manual(values = c("firebrick","black")) +
  ylab("Abundance of Syndiniales metabarcodes (%)")

grid.arrange(nrow=2,p10,p11,p12,p13)

# Count number of Syndiniales, Dinophyceae and Dinoflagellata sequences in the global dataset
tax_all=read.csv("/shared/projects/formaldark/Data_stageM2/All_seq_taxTable_noAB_PR2_EKsilva.csv",h=T,sep=";")

100*nrow(tax_all[tax_all$Class=="Dinophyceae",])/nrow(tax_all)
100*nrow(tax_all[tax_all$Class=="Syndiniales",])/nrow(tax_all)

nrow(tax_all[tax_all$Division=="Dinoflagellata",])
100*nrow(tax_all[tax_all$Division=="Dinoflagellata",])/nrow(tax_all)

# Unassigned Syndiniales sequences (genus level)
synd <- (tax_all[tax_all$Class=="Syndiniales",])
nrow(synd[synd$Genus=="Unknown",])
100*nrow(synd[synd$Genus=="Unknown",])/nrow(tax_all)

```